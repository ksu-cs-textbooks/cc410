<!doctype html><html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.128.0"><meta name=generator content="Relearn 6.0.0"><meta name=description content="YouTube Video One of the major selling points of Python is that it is dynamically typed. This means that the data type of variables is determined at runtime, and a single variable can store multiple data types throughout the execution of the program.
While this can make development seem quick and easy, it can also cause programmers to make mistakes related to the handling of various data types that wouldn’t be present in statically typed languages such as Java, C++, or C#."><meta name=author content="Russell Feldhausen"><meta name=twitter:card content="summary"><meta name=twitter:title content="Type Checking :: CC 410 Textbook"><meta name=twitter:description content="YouTube Video One of the major selling points of Python is that it is dynamically typed. This means that the data type of variables is determined at runtime, and a single variable can store multiple data types throughout the execution of the program.
While this can make development seem quick and easy, it can also cause programmers to make mistakes related to the handling of various data types that wouldn’t be present in statically typed languages such as Java, C++, or C#."><meta property="og:url" content="https://textbooks.cs.ksu.edu/cc410/z-examples/01-hello-real-world/04-python/09-type-checking/"><meta property="og:site_name" content="CC 410 Textbook"><meta property="og:title" content="Type Checking :: CC 410 Textbook"><meta property="og:description" content="YouTube Video One of the major selling points of Python is that it is dynamically typed. This means that the data type of variables is determined at runtime, and a single variable can store multiple data types throughout the execution of the program.
While this can make development seem quick and easy, it can also cause programmers to make mistakes related to the handling of various data types that wouldn’t be present in statically typed languages such as Java, C++, or C#."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="Example Projects"><meta property="article:modified_time" content="2024-06-17T14:13:48-05:00"><meta itemprop=name content="Type Checking :: CC 410 Textbook"><meta itemprop=description content="YouTube Video One of the major selling points of Python is that it is dynamically typed. This means that the data type of variables is determined at runtime, and a single variable can store multiple data types throughout the execution of the program.
While this can make development seem quick and easy, it can also cause programmers to make mistakes related to the handling of various data types that wouldn’t be present in statically typed languages such as Java, C++, or C#."><meta itemprop=dateModified content="2024-06-17T14:13:48-05:00"><meta itemprop=wordCount content="1969"><title>Type Checking :: CC 410 Textbook</title>
<link href=https://textbooks.cs.ksu.edu/cc410/z-examples/01-hello-real-world/04-python/09-type-checking/ rel=canonical type=text/html title="Type Checking :: CC 410 Textbook"><link href=/cc410/z-examples/01-hello-real-world/04-python/09-type-checking/index.xml rel=alternate type=application/rss+xml title="Type Checking :: CC 410 Textbook"><link href=/cc410/z-examples/01-hello-real-world/04-python/09-type-checking/tele.html rel=alternate type=text/html title="Type Checking :: CC 410 Textbook"><link href=/cc410/z-examples/01-hello-real-world/04-python/09-type-checking/embed.html rel=alternate type=text/html title="Type Checking :: CC 410 Textbook"><link href=/cc410/images/favicon.ico?1719507172 rel=icon type=image/x-icon sizes=any><link href=/cc410/css/fontawesome-all.min.css?1719507305 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cc410/css/fontawesome-all.min.css?1719507305 rel=stylesheet></noscript><link href=/cc410/css/nucleus.css?1719507305 rel=stylesheet><link href=/cc410/css/auto-complete.css?1719507305 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cc410/css/auto-complete.css?1719507305 rel=stylesheet></noscript><link href=/cc410/css/perfect-scrollbar.min.css?1719507305 rel=stylesheet><link href=/cc410/css/fonts.css?1719507305 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cc410/css/fonts.css?1719507305 rel=stylesheet></noscript><link href=/cc410/css/theme.css?1719507305 rel=stylesheet><link href=/cc410/css/theme-auto.css?1719507305 rel=stylesheet id=R-variant-style><link href=/cc410/css/chroma-auto.css?1719507305 rel=stylesheet id=R-variant-chroma-style><link href=/cc410/css/variant.css?1719507305 rel=stylesheet><link href=/cc410/css/print.css?1719507305 rel=stylesheet media=print><link href=/cc410/css/format-print.css?1719507305 rel=stylesheet><script src=/cc410/js/variant.js?1719507305></script><script>window.relearn=window.relearn||{},window.relearn.relBasePath="../../../..",window.relearn.relBaseUri="../../../../..",window.relearn.absBaseUri="https://textbooks.cs.ksu.edu/cc410",window.index_js_url="/cc410/index.search.js",window.variants&&variants.init(["auto","light-theme","dark-theme"]),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><link href=/cc410/css/custom.css?1719507305 rel=stylesheet></head><body class="mobile-support print disableInlineCopyToClipboard" data-url=/cc410/z-examples/01-hello-real-world/04-python/09-type-checking/><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/cc410/z-examples/><span itemprop=name>Example Projects</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/cc410/z-examples/01-hello-real-world/><span itemprop=name>Hello Real World</span></a><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/cc410/z-examples/01-hello-real-world/04-python/><span itemprop=name>Python</span></a><meta itemprop=position content="3">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Type Checking</span><meta itemprop=position content="4"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/cc410/z-examples/01-hello-real-world/04-python/08-flake8/ title="Flake8 (🡐)"><i class="fa-fw fas fa-chevron-left"></i></a></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/cc410/z-examples/01-hello-real-world/04-python/10-hamcrest/ title="Hamcrest (🡒)"><i class="fa-fw fas fa-chevron-right"></i></a></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=type-checking>Type Checking</h1><a href="https://www.youtube.com/watch?v=MFaEO1cTlck">YouTube Video</a><p>One of the major selling points of Python is that it is <strong>dynamically typed</strong>. This means that the data type of variables is determined at runtime, and a single variable can store multiple data types throughout the execution of the program.</p><p>While this can make development seem quick and easy, it can also cause programmers to make mistakes related to the handling of various data types that wouldn&rsquo;t be present in statically typed languages such as Java, C++, or C#. Those languages require compilation before they can be executed, and one step that the compiler performs is <strong>type checking</strong>. Type checking is a process that makes sure each value that is ever assigned to a variable has the correct type - otherwise the program won&rsquo;t compile properly.</p><p>Thankfully, with the addition of <strong>type hinting</strong> in Python, we can use a tool to perform type checking on our code as well. Let&rsquo;s see what that would look like!</p><h2 id=type-hinting-in-python>Type Hinting in Python</h2><p>Let&rsquo;s review our existing code in <code>HelloWorld.py</code> and see what it would look like with type hints added. The code is shown here without any docstrings just to make it easier to read:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>HelloWorld</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@staticmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>main</span><span class=p>(</span><span class=n>args</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>args</span><span class=p>)</span> <span class=o>==</span> <span class=mi>2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Hello </span><span class=si>{}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>args</span><span class=p>[</span><span class=mi>1</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Hello World&#34;</span><span class=p>)</span></span></span></code></pre></div><p>To add type hinting, we need to add information to each variable and function at a bare minimum. So, let&rsquo;s look at the function first.</p><p>Recall that functions can return a value using the <code>return</code> keyword. We don&rsquo;t see that in our <code>main</code> function, so it doesn&rsquo;t return a value, right? In fact, any Python function that doesn&rsquo;t explicitly return a value within the code actually returns the value <code>None</code> by default. So, we would say that the &ldquo;return type&rdquo; of the function <code>main</code> is <code>None</code></p><p>To annotate that with a type hint, we would modify the code to look like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>HelloWorld</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@staticmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>main</span><span class=p>(</span><span class=n>args</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>args</span><span class=p>)</span> <span class=o>==</span> <span class=mi>2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Hello </span><span class=si>{}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>args</span><span class=p>[</span><span class=mi>1</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Hello World&#34;</span><span class=p>)</span></span></span></code></pre></div><p>Notice that we simply added <code>-> None</code> after the function name and arguments, but before the colon <code>:</code>. That&rsquo;s all it takes!</p><p>Likewise, we should annotate each variable, including all of the function parameters. So, in our function, we are expecting a parameter named <code>args</code>. What type of data would be stored in <code>args</code>?</p><p>Recall that <code>args</code> is a stand in for <code>sys.argv</code>, which are the command line arguments provided to Python when the program is executed. <code>sys.argv</code> is a list of strings, so the type of <code>args</code> would also be a list of strings. Therefore, we can annotate it in this way:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>List</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>HelloWorld</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@staticmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>main</span><span class=p>(</span><span class=n>args</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>args</span><span class=p>)</span> <span class=o>==</span> <span class=mi>2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Hello </span><span class=si>{}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>args</span><span class=p>[</span><span class=mi>1</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Hello World&#34;</span><span class=p>)</span></span></span></code></pre></div><p>In this case, we added two things:</p><ul><li>For some special types, such as collections like lists, we&rsquo;ll need to import the proper type from the <code>typing</code> library.</li><li>After each variable is named, we can place a colon followed by the type of the variable. In the case of <code>args</code>, we set the type to <code>List[str]</code>, which represents a list of strings.</li></ul><p>There we go! We&rsquo;ve added type hints to our source code. If you want to learn more about how to add type hints to your code, here are some great resources:</p><ul><li><a href=https://docs.python.org/3/library/typing.html rel=external target=_blank>Typing</a> in the Python Documentation</li><li><a href=https://realpython.com/python-type-checking/ rel=external target=_blank>Python Type Checking Guide</a> from Real Python</li><li><a href=https://mypy.readthedocs.io/en/stable/cheat_sheet_py3.html rel=external target=_blank>Type Hints Cheat Sheet</a> from Mypy</li><li><a href=https://mypy.readthedocs.io/en/stable/builtin_types.html rel=external target=_blank>Type System Reference</a> from Mypy</li></ul><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Codio IDE and Type Hinting</div><div class=box-content><p>Unfortunately, the Codio IDE does not properly deal with type hinting in Python, and will tell us that our code contains a syntax error:</p><p><a href=#R-image-c5211218c07e9302656a98cdd422570d class=lightbox-link><img alt="Codio LSP Type Hinting" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cc410/images/e1/29codiotype.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-c5211218c07e9302656a98cdd422570d><img alt="Codio LSP Type Hinting" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cc410/images/e1/29codiotype.png></a></p><p>We can safely ignore that error, provided that our code passes the Flake8 style checker itself.</p></div></div><h2 id=type-checking-with-mypy>Type Checking with Mypy</h2><p>Now that we&rsquo;ve added some type hints to our code, how can we check to make sure our code doesn&rsquo;t violate those hints? To do that, we can use a static type checker called Mypy. [Mypy] is a powerful tool that allows us to quickly and easily spot typing errors in our Python code. However, it has one major caveat - it will only catch type errors for variables or functions that include type hints. It <strong>will not</strong> report all type errors in code that does not include type hints, nor will it tell us if some type hints are missing. So, it is up to us as developers to include all of the appropriate type hints ourselves!</p><p>To install Mypy, we can simply add the appropriate line to our <code>requirements.txt</code> file. We&rsquo;ll also install the <code>lxml</code> library, so we can generate HTML reports from Mypy. Once we&rsquo;ve added those lines, our requirements file should now look like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-tex data-lang=tex><span class=line><span class=cl>coverage
</span></span><span class=line><span class=cl>flake8
</span></span><span class=line><span class=cl>flake8-docstrings
</span></span><span class=line><span class=cl>flake8-html
</span></span><span class=line><span class=cl>lxml
</span></span><span class=line><span class=cl>mypy
</span></span><span class=line><span class=cl>pdoc3
</span></span><span class=line><span class=cl>pep8-naming
</span></span><span class=line><span class=cl>pytest
</span></span><span class=line><span class=cl>pytest-html
</span></span><span class=line><span class=cl>tox</span></span></code></pre></div><p>Then, we can make sure those libraries are installed by running this command from within the <code>python</code> directory:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pip3 install -r requirements.txt</span></span></code></pre></div><p>As always, once we&rsquo;ve run that command we can verify that the library was installed by looking at the output:</p><p><a href=#R-image-67d85e873111e891c1a2310a66adce57 class=lightbox-link><img alt="Install Mypy" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cc410/images/e1/29installmypy.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-67d85e873111e891c1a2310a66adce57><img alt="Install Mypy" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cc410/images/e1/29installmypy.png></a></p><h2 id=running-mypy>Running Mypy</h2><p>Once we&rsquo;ve installed Mypy, we can execute it using the following command from within the <code>python</code> directory:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>python3 -m mypy -p src --strict --html-report reports/mypy</span></span></code></pre></div><p>As always, let&rsquo;s break this command down into its separate parts:</p><ul><li><code>python3 -m mpyp</code> - we want to run the Mypy library as a Python module</li><li><code>-p src</code> - this tells Mypy to execute the code in our <code>src</code> meta package, which will include all source code files inside of that directory.</li><li><code>--strict</code> - we want to enable all optional checks that Mypy can perform</li><li><code>--html-report reports/mypy</code> - this will create an HTML report in the <code>reports/mypy</code> directory</li></ul><p>If everything is working correctly, we should get the following output:</p><p><a href=#R-image-338f7c6c3aa59525d60893593823d734 class=lightbox-link><img alt="Mypy Success" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cc410/images/e1/29mypygood.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-338f7c6c3aa59525d60893593823d734><img alt="Mypy Success" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cc410/images/e1/29mypygood.png></a></p><p>We may notice a new <code>.mypy_cache</code> folder, which can be safely ignored just like the <code>.pytest_cache</code> folder next to it. We can also find an HTML report in <code>reports/mypy/index.html</code>:</p><p><a href=#R-image-379af11a3755bc843b97cacde5f39cee class=lightbox-link><img alt="Mypy Report" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cc410/images/e1/29mypyreport.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-379af11a3755bc843b97cacde5f39cee><img alt="Mypy Report" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cc410/images/e1/29mypyreport.png></a></p><p>To open that file, simply <strong>right-click</strong> on it and select <strong>Preview Static</strong>. When we do that, we should get a report that looks like this:</p><p><a href=#R-image-ba0966ac3f24e6c97a311a23ac706916 class=lightbox-link><img alt="Mypy HTML" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cc410/images/e1/29mypyhtml.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-ba0966ac3f24e6c97a311a23ac706916><img alt="Mypy HTML" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cc410/images/e1/29mypyhtml.png></a></p><p>As we can see, Mypy shows that we&rsquo;ve properly type hinted all of the code! That&rsquo;s great!</p><h2 id=integrating-with-tox>Integrating with Tox</h2><p>We can also integrate Mypy with tox by simply adding the command above to the <code>tox.ini</code> file in the commands section, which should now look like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=na>commands</span> <span class=o>=</span> <span class=s>python3 -m mypy -p src --strict --html-report reports/mypy
</span></span></span><span class=line><span class=cl><span class=s>           python3 -m coverage run --source src -m pytest --html=reports/pytest/index.html
</span></span></span><span class=line><span class=cl><span class=s>           python3 -m coverage html -d reports/coverage
</span></span></span><span class=line><span class=cl><span class=s>           python3 -m flake8 --docstring-convention google --format=html --htmldir=reports/flake
</span></span></span><span class=line><span class=cl><span class=s>           python3 -m pdoc --html --force --output-dir reports/doc .</span></span></span></code></pre></div><p>Notice that the Mypy command is now first in the list of commands. This mimics what most other programming languages would do - the code must pass the type checker in the compiler before the unit tests can be executed. So, we&rsquo;ll do the same with our Python code here.</p><p>Once we&rsquo;ve updated <code>tox.ini</code>, we can rerun tox using this command:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>tox -r</span></span></code></pre></div><p>That should now run all of our test commands at once!</p><h2 id=type-checking-unit-tests>Type Checking Unit Tests</h2><p>Now, let&rsquo;s briefly review how to type check our unit tests. This is a <strong>much</strong> more difficult task, since our unit tests build upon several external libraries. Thankfully, the Mypy library includes a way for us to explore the types that it is able to infer.</p><p>So, in our <code>test_HelloWorld.py</code> file, let&rsquo;s add the line <code>reveal_locals()</code> to the bottom of one of our test methods. We&rsquo;ll also need to annotate the function&rsquo;s return type so that Mypy will analyze it, so we&rsquo;ll set it to <code>None</code> as we did above. As before, the docstrings have been omitted from this code:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>src.hello.HelloWorld</span> <span class=kn>import</span> <span class=n>HelloWorld</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>TestHelloWorld</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>test_hello_world</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>capsys</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>HelloWorld</span><span class=o>.</span><span class=n>main</span><span class=p>([</span><span class=s2>&#34;HelloWorld&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=n>captured</span> <span class=o>=</span> <span class=n>capsys</span><span class=o>.</span><span class=n>readouterr</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>assert</span> <span class=n>captured</span><span class=o>.</span><span class=n>out</span> <span class=o>==</span> <span class=s2>&#34;Hello World</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;Unexpected Output&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>reveal_locals</span><span class=p>()</span></span></span></code></pre></div><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Mypy Expressions</div><div class=box-content><p>The line <code>reveal_locals()</code> is a handy expression for adding type checking to our Python code. However, the Python interpreter itself won&rsquo;t recognize that line as valid Python code, so we&rsquo;ll have to remove it before we can actually execute our tests again. We&rsquo;re just using it temporarily to help us determine the types that Mypy finds for the variables in our code</p></div></div><p>Now, let&rsquo;s analyze the code in our <code>test</code> folder using Mypy:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>python3 -m mypy --strict test</span></span></code></pre></div><p>Notice that we are just giving it the name of the directory <code>test</code> instead of loading it as a Python meta package. This is because we didn&rsquo;t include an <code>__init__.py</code> file inside of the <code>test</code> directory itself. Don&rsquo;t worry - Mypy is able to handle it just fine! When we run that command, we&rsquo;ll see output like this:</p><p><a href=#R-image-394d0b877f861dba73458303688b2b5c class=lightbox-link><img alt="Local Variable Types" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cc410/images/e1/29locals.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-394d0b877f861dba73458303688b2b5c><img alt="Local Variable Types" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cc410/images/e1/29locals.png></a></p><p>In that output, we&rsquo;ll see that the Mypy library was not able to determine the type of the <code>capsys</code> and <code>captured</code> variables. Instead, it just reports that they could be <code>Any</code> type, which is a special type annotation that matches any possible type. This is due to the fact that we didn&rsquo;t actually have to import the <code>pytest</code> library to use those variables. This is a powerful feature of Python, but it makes it more difficult to perform proper type checking. It will also complain that we now have method arguments that are missing annotations, so let&rsquo;s see if we can resolve that.</p><div class="box notices cstyle note"><div class=box-label><i class="fa-fw fas fa-exclamation-circle"></i> Read the Source, Luke</div><div class=box-content><p>Unfortunately, figuring out the rest of this required lots of poking around the <a href=https://github.com/pytest-dev/pytest/blob/master/src/_pytest/capture.py rel=external target=_blank>pytest source code</a>, specifically in the file for capturing system output. Static type checking in Python is simply more difficult than in other languages because of the way it handles dynamic typing and library imports at runtime.</p><p>We&rsquo;ll go ahead and explore what it takes to properly add type hinting to unit tests here, but you <strong>will not</strong> be required to be this thorough in your own unit tests in this course. That is simply asking too much!</p></div></div><p>So, let&rsquo;s import those libraries by adding them to the top of the file. We&rsquo;ll start by importing the <code>CaptureFixture</code> class from <code>pytest</code>, as well as the <code>AnyStr</code> type from the <code>typing</code> library. Then, we can annotate the <code>capsys</code> parameter with the appropriate type, which is <code>CaptureFixture[Any]</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pytest</span> <span class=kn>import</span> <span class=n>CaptureFixture</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Any</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>src.hello.HelloWorld</span> <span class=kn>import</span> <span class=n>HelloWorld</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>TestHelloWorld</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>test_hello_world</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>capsys</span><span class=p>:</span> <span class=n>CaptureFixture</span><span class=p>[</span><span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>HelloWorld</span><span class=o>.</span><span class=n>main</span><span class=p>([</span><span class=s2>&#34;HelloWorld&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=n>captured</span> <span class=o>=</span> <span class=n>capsys</span><span class=o>.</span><span class=n>readouterr</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>assert</span> <span class=n>captured</span><span class=o>.</span><span class=n>out</span> <span class=o>==</span> <span class=s2>&#34;Hello World</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;Unexpected Output&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>reveal_locals</span><span class=p>()</span></span></span></code></pre></div><p>Once that is in place, we can rerun our Mypy check and should get the following output:</p><p><a href=#R-image-0f798fbdba830a680602f8665231f84f class=lightbox-link><img alt="Mypy Fixtures" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cc410/images/e1/29fixture.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-0f798fbdba830a680602f8665231f84f><img alt="Mypy Fixtures" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cc410/images/e1/29fixture.png></a></p><p>That&rsquo;s closer! Now Mypy is finding the correct types for <code>capsys</code> and was able to use the information in the <code>pytest</code> library to infer the type of the <code>captured</code> variable, which is returned from the <code>capsys.readouterr()</code> function call. So, let&rsquo;s annotate that variable as well. To do that, we&rsquo;ll need to import the <code>CaptureResult</code> class from the <code>_pytest.capture</code> library. As you might guess by the underscore at the beginning of the library name, we are importing a class that is meant to be internal to pytest. This is generally considered bad practice, but it helps for type checking, so we&rsquo;ll do it for now. Our updated code looks like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pytest</span> <span class=kn>import</span> <span class=n>CaptureFixture</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>_pytest.capture</span> <span class=kn>import</span> <span class=n>CaptureResult</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Any</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>src.hello.HelloWorld</span> <span class=kn>import</span> <span class=n>HelloWorld</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>TestHelloWorld</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>test_hello_world</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>capsys</span><span class=p>:</span> <span class=n>CaptureFixture</span><span class=p>[</span><span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>HelloWorld</span><span class=o>.</span><span class=n>main</span><span class=p>([</span><span class=s2>&#34;HelloWorld&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=n>captured</span><span class=p>:</span> <span class=n>CaptureResult</span><span class=p>[</span><span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=n>capsys</span><span class=o>.</span><span class=n>readouterr</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>assert</span> <span class=n>captured</span><span class=o>.</span><span class=n>out</span> <span class=o>==</span> <span class=s2>&#34;Hello World</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;Unexpected Output&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>reveal_locals</span><span class=p>()</span></span></span></code></pre></div><p>Notice that we can easily add a type hint to a variable in the same way we added type hints to method parameters - we just place a colon <code>:</code> after the variable name and then add the type. Now, when we run the Mypy command, we should get the same output, which confirms that we have the correct type hints:</p><p><a href=#R-image-549709b3bcf11a31d20dc3197c8581fd class=lightbox-link><img alt="Mypy Result" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cc410/images/e1/29result.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-549709b3bcf11a31d20dc3197c8581fd><img alt="Mypy Result" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cc410/images/e1/29result.png></a></p><p>Once we&rsquo;ve done that, we can remove the <code>reveal_locals()</code> line to make sure the tests will still execute.</p><p>Feel free to add the appropriate type hints to your unit tests if you&rsquo;d like. However you <strong>are not required</strong> to include type hints in your unit tests, due to the complexity that we encountered here.</p><footer class=footline></footer></article></div></main><div class=git-footer><p class=theme-version-footer>6.0.0</p><p>Last modified by:
<i class='fas fa-user'></i> Russell Feldhausen
<i class='fas fa-calendar'></i> <a href=https://github.com/ksu-cs-textbooks/cc410/commit/1b3be09e9a32c703d266d0790414fde22b705b91>Jun 17, 2024</a></p></div></div><script src=/cc410/js/clipboard.min.js?1719507305 defer></script><script src=/cc410/js/perfect-scrollbar.min.js?1719507305 defer></script><script src=/cc410/js/theme.js?1719507305 defer></script></body></html>