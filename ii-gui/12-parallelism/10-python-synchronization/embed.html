<!DOCTYPE html>

<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article" data-r-output-format="html">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.148.1">
    <meta name="generator" content="Relearn 8.0.0">
    <meta name="description" content="Next, let’s look at a quick example of a race condition in Python, just so we can see how it could occur in our code.
Poorly Designed Multithreading First, let’s consider this example:
import threading import time import sys class MyData: def __init__(self): self.x = 0 class MyThread: data = MyData() def __init__(self, name): &#34;&#34;&#34;Constructor. Args: name: the name of the thread &#34;&#34;&#34; self.__name = name def run(self): &#34;&#34;&#34;Thread method.&#34;&#34;&#34; for i in range(0, 3): y = MyThread.data.x # tell the OS it is ok to switch to another thread here time.sleep(0) MyThread.data.x = y &#43; 1 print(&#34;{} : data.x = {}&#34;.format(self.__name, MyThread.data.x)) @staticmethod def main(args): # create threads t1_object = MyThread(&#34;Thread 1&#34;) thread1 = threading.Thread(target=t1_object.run) t2_object = MyThread(&#34;Thread 2&#34;) thread2 = threading.Thread(target=t2_object.run) t3_object = MyThread(&#34;Thread 3&#34;) thread3 = threading.Thread(target=t3_object.run) # start threads print(&#34;main: starting threads&#34;) thread1.start() thread2.start() thread3.start() # wait until all threads have terminated print(&#34;main: joining threads&#34;) thread1.join() thread2.join() thread3.join() print(&#34;main: all threads terminated&#34;) print(&#34;main: data.x = {}&#34;.format(MyThread.data.x)) # main guard if __name__ == &#34;__main__&#34;: MyThread.main(sys.argv) Explanation In this example, we are creating a static instance of the MyData class, attached directly to the MyThread class and not a particular object, which can act as a shared memory object for this example. Then, in each of the threads, we are performing this three-step process:">
    <meta name="author" content="Russell Feldhausen">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://textbooks.cs.ksu.edu/cc410/images/hero.png">
    <meta name="twitter:title" content="Python Synchronization :: CC 410 Textbook">
    <meta name="twitter:description" content="Next, let’s look at a quick example of a race condition in Python, just so we can see how it could occur in our code.
Poorly Designed Multithreading First, let’s consider this example:
import threading import time import sys class MyData: def __init__(self): self.x = 0 class MyThread: data = MyData() def __init__(self, name): &#34;&#34;&#34;Constructor. Args: name: the name of the thread &#34;&#34;&#34; self.__name = name def run(self): &#34;&#34;&#34;Thread method.&#34;&#34;&#34; for i in range(0, 3): y = MyThread.data.x # tell the OS it is ok to switch to another thread here time.sleep(0) MyThread.data.x = y &#43; 1 print(&#34;{} : data.x = {}&#34;.format(self.__name, MyThread.data.x)) @staticmethod def main(args): # create threads t1_object = MyThread(&#34;Thread 1&#34;) thread1 = threading.Thread(target=t1_object.run) t2_object = MyThread(&#34;Thread 2&#34;) thread2 = threading.Thread(target=t2_object.run) t3_object = MyThread(&#34;Thread 3&#34;) thread3 = threading.Thread(target=t3_object.run) # start threads print(&#34;main: starting threads&#34;) thread1.start() thread2.start() thread3.start() # wait until all threads have terminated print(&#34;main: joining threads&#34;) thread1.join() thread2.join() thread3.join() print(&#34;main: all threads terminated&#34;) print(&#34;main: data.x = {}&#34;.format(MyThread.data.x)) # main guard if __name__ == &#34;__main__&#34;: MyThread.main(sys.argv) Explanation In this example, we are creating a static instance of the MyData class, attached directly to the MyThread class and not a particular object, which can act as a shared memory object for this example. Then, in each of the threads, we are performing this three-step process:">
    <meta property="og:url" content="https://textbooks.cs.ksu.edu/cc410/ii-gui/12-parallelism/10-python-synchronization/index.html">
    <meta property="og:site_name" content="CC 410 Textbook">
    <meta property="og:title" content="Python Synchronization :: CC 410 Textbook">
    <meta property="og:description" content="Next, let’s look at a quick example of a race condition in Python, just so we can see how it could occur in our code.
Poorly Designed Multithreading First, let’s consider this example:
import threading import time import sys class MyData: def __init__(self): self.x = 0 class MyThread: data = MyData() def __init__(self, name): &#34;&#34;&#34;Constructor. Args: name: the name of the thread &#34;&#34;&#34; self.__name = name def run(self): &#34;&#34;&#34;Thread method.&#34;&#34;&#34; for i in range(0, 3): y = MyThread.data.x # tell the OS it is ok to switch to another thread here time.sleep(0) MyThread.data.x = y &#43; 1 print(&#34;{} : data.x = {}&#34;.format(self.__name, MyThread.data.x)) @staticmethod def main(args): # create threads t1_object = MyThread(&#34;Thread 1&#34;) thread1 = threading.Thread(target=t1_object.run) t2_object = MyThread(&#34;Thread 2&#34;) thread2 = threading.Thread(target=t2_object.run) t3_object = MyThread(&#34;Thread 3&#34;) thread3 = threading.Thread(target=t3_object.run) # start threads print(&#34;main: starting threads&#34;) thread1.start() thread2.start() thread3.start() # wait until all threads have terminated print(&#34;main: joining threads&#34;) thread1.join() thread2.join() thread3.join() print(&#34;main: all threads terminated&#34;) print(&#34;main: data.x = {}&#34;.format(MyThread.data.x)) # main guard if __name__ == &#34;__main__&#34;: MyThread.main(sys.argv) Explanation In this example, we are creating a static instance of the MyData class, attached directly to the MyThread class and not a particular object, which can act as a shared memory object for this example. Then, in each of the threads, we are performing this three-step process:">
    <meta property="og:locale" content="en_us">
    <meta property="og:type" content="article">
    <meta property="article:section" content="GUI">
    <meta property="article:modified_time" content="2023-01-19T16:21:53-06:00">
    <meta property="og:image" content="https://textbooks.cs.ksu.edu/cc410/images/hero.png">
    <meta itemprop="name" content="Python Synchronization :: CC 410 Textbook">
    <meta itemprop="description" content="Next, let’s look at a quick example of a race condition in Python, just so we can see how it could occur in our code.
Poorly Designed Multithreading First, let’s consider this example:
import threading import time import sys class MyData: def __init__(self): self.x = 0 class MyThread: data = MyData() def __init__(self, name): &#34;&#34;&#34;Constructor. Args: name: the name of the thread &#34;&#34;&#34; self.__name = name def run(self): &#34;&#34;&#34;Thread method.&#34;&#34;&#34; for i in range(0, 3): y = MyThread.data.x # tell the OS it is ok to switch to another thread here time.sleep(0) MyThread.data.x = y &#43; 1 print(&#34;{} : data.x = {}&#34;.format(self.__name, MyThread.data.x)) @staticmethod def main(args): # create threads t1_object = MyThread(&#34;Thread 1&#34;) thread1 = threading.Thread(target=t1_object.run) t2_object = MyThread(&#34;Thread 2&#34;) thread2 = threading.Thread(target=t2_object.run) t3_object = MyThread(&#34;Thread 3&#34;) thread3 = threading.Thread(target=t3_object.run) # start threads print(&#34;main: starting threads&#34;) thread1.start() thread2.start() thread3.start() # wait until all threads have terminated print(&#34;main: joining threads&#34;) thread1.join() thread2.join() thread3.join() print(&#34;main: all threads terminated&#34;) print(&#34;main: data.x = {}&#34;.format(MyThread.data.x)) # main guard if __name__ == &#34;__main__&#34;: MyThread.main(sys.argv) Explanation In this example, we are creating a static instance of the MyData class, attached directly to the MyThread class and not a particular object, which can act as a shared memory object for this example. Then, in each of the threads, we are performing this three-step process:">
    <meta itemprop="dateModified" content="2023-01-19T16:21:53-06:00">
    <meta itemprop="wordCount" content="686">
    <meta itemprop="image" content="https://textbooks.cs.ksu.edu/cc410/images/hero.png">
    <title>Python Synchronization :: CC 410 Textbook</title>
    <link href="https://textbooks.cs.ksu.edu/cc410/ii-gui/12-parallelism/10-python-synchronization/index.html" rel="canonical" type="text/html" title="Python Synchronization :: CC 410 Textbook">
    <link href="/cc410/ii-gui/12-parallelism/10-python-synchronization/index.xml" rel="alternate" type="application/rss+xml" title="Python Synchronization :: CC 410 Textbook">
    <link href="/cc410/ii-gui/12-parallelism/10-python-synchronization/index.print.html" rel="alternate" type="text/html" title="Python Synchronization :: CC 410 Textbook">
    <link href="/cc410/ii-gui/12-parallelism/10-python-synchronization/tele.html" rel="alternate" type="text/html" title="Python Synchronization :: CC 410 Textbook">
    <link href="/cc410/images/favicon.ico?1757434985" rel="icon" type="image/x-icon" sizes="any">
    <link href="/cc410/css/auto-complete/auto-complete.min.css?1757434985" rel="stylesheet">
    <script src="/cc410/js/auto-complete/auto-complete.min.js?1757434985" defer></script>
    <script src="/cc410/js/search-lunr.min.js?1757434985" defer></script>
    <script src="/cc410/js/search.min.js?1757434985" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.index_js_url="/cc410/searchindex.en.js?1757434985";
    </script>
    <script src="/cc410/js/lunr/lunr.min.js?1757434985" defer></script>
    <script src="/cc410/js/lunr/lunr.stemmer.support.min.js?1757434985" defer></script>
    <script src="/cc410/js/lunr/lunr.multi.min.js?1757434985" defer></script>
    <script src="/cc410/js/lunr/lunr.en.min.js?1757434985" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.contentLangs=['en'];
    </script>
    <link href="/cc410/fonts/fontawesome/css/fontawesome-all.min.css?1757434985" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/cc410/fonts/fontawesome/css/fontawesome-all.min.css?1757434985" rel="stylesheet"></noscript>
    <link href="/cc410/css/perfect-scrollbar/perfect-scrollbar.min.css?1757434985" rel="stylesheet">
    <link href="/cc410/css/theme.min.css?1757434985" rel="stylesheet">
    <link href="/cc410/css/format-html.min.css?1757434985" rel="stylesheet" id="R-format-style">
    <script>
      window.relearn = window.relearn || {};
      // configuration
      window.relearn.min = `.min`;
      window.relearn.path='\/ii-gui\/12-parallelism\/10-python-synchronization\/index.html';
      window.relearn.relBasePath='..\/..\/..';
      window.relearn.relBaseUri='..\/..\/..\/..';
      window.relearn.absBaseUri='https:\/\/textbooks.cs.ksu.edu\/cc410';
      window.relearn.disableAnchorCopy=false;
      window.relearn.disableAnchorScrolling=false;
      window.relearn.disableInlineCopyToClipboard=true;
      window.relearn.enableBlockCodeWrap=false;
      // legal
      window.relearn.getItem = (s,n) => {return s.getItem(n)};
      window.relearn.setItem = (s,n,v) => {return s.setItem(n,v)};
      window.relearn.removeItem = (s,n) => {return s.removeItem(n)};
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
      // variant stuff
      window.relearn.themevariants = [ 'light-theme' ];
      window.relearn.customvariantname = "my-custom-variant";
      // [x] russfeld
      window.relearn.writeVariant=false;
      window.relearn.changeVariant = function(variant) {
        var oldVariant = document.documentElement.dataset.rThemeVariant;
        window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
        document.documentElement.dataset.rThemeVariant = variant;
        if (oldVariant != variant) {
          document.dispatchEvent( new CustomEvent('themeVariantLoaded', { detail: { variant, oldVariant } }) );
          window.relearn.markVariant();
        }
      }
      window.relearn.markVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant");
        document.querySelectorAll(".R-variantswitcher select").forEach((select) => {select.value = variant;});
      }
      window.relearn.initVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant") ?? "";
        if( variant == window.relearn.customvariantname ){
        }else if( !variant || !window.relearn.themevariants.includes(variant) ){
          variant = window.relearn.themevariants[0];
          
          if (window.relearn.writeVariant) {
            window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
          }
        }
        document.documentElement.dataset.rThemeVariant = variant;
      }
      window.relearn.initVariant();
      window.relearn.markVariant();
    </script>
    <link href="/cc410/css/custom.css?1757434985" rel="stylesheet">
  </head>
  <body class="mobile-support embed html" data-url="/cc410/ii-gui/12-parallelism/10-python-synchronization/index.html">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      
      
      
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable ii-gui" tabindex="-1">
        <div class="flex-block-wrapper">
<article class="default">
  <header class="headline">
  </header>

<h1 id="python-synchronization">Python Synchronization</h1>

<p>Next, let&rsquo;s look at a quick example of a race condition in Python, just so we can see how it could occur in our code.</p>
<h2 id="poorly-designed-multithreading">Poorly Designed Multithreading</h2>
<p>First, let&rsquo;s consider this example:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> threading
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> sys
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyData</span>:
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__init__</span>(self):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>x <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyThread</span>:
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    data <span style="color:#f92672">=</span> MyData()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__init__</span>(self, name):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Constructor.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        Args:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            name: the name of the thread
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>__name <span style="color:#f92672">=</span> name
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">run</span>(self):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Thread method.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">3</span>):
</span></span><span style="display:flex;"><span>            y <span style="color:#f92672">=</span> MyThread<span style="color:#f92672">.</span>data<span style="color:#f92672">.</span>x
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># tell the OS it is ok to switch to another thread here</span>
</span></span><span style="display:flex;"><span>            time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>            MyThread<span style="color:#f92672">.</span>data<span style="color:#f92672">.</span>x <span style="color:#f92672">=</span> y <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{}</span><span style="color:#e6db74"> : data.x = </span><span style="color:#e6db74">{}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>format(self<span style="color:#f92672">.</span>__name, MyThread<span style="color:#f92672">.</span>data<span style="color:#f92672">.</span>x))
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@staticmethod</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>(args):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># create threads</span>
</span></span><span style="display:flex;"><span>        t1_object <span style="color:#f92672">=</span> MyThread(<span style="color:#e6db74">&#34;Thread 1&#34;</span>)
</span></span><span style="display:flex;"><span>        thread1 <span style="color:#f92672">=</span> threading<span style="color:#f92672">.</span>Thread(target<span style="color:#f92672">=</span>t1_object<span style="color:#f92672">.</span>run)
</span></span><span style="display:flex;"><span>        t2_object <span style="color:#f92672">=</span> MyThread(<span style="color:#e6db74">&#34;Thread 2&#34;</span>)
</span></span><span style="display:flex;"><span>        thread2 <span style="color:#f92672">=</span> threading<span style="color:#f92672">.</span>Thread(target<span style="color:#f92672">=</span>t2_object<span style="color:#f92672">.</span>run)
</span></span><span style="display:flex;"><span>        t3_object <span style="color:#f92672">=</span> MyThread(<span style="color:#e6db74">&#34;Thread 3&#34;</span>)
</span></span><span style="display:flex;"><span>        thread3 <span style="color:#f92672">=</span> threading<span style="color:#f92672">.</span>Thread(target<span style="color:#f92672">=</span>t3_object<span style="color:#f92672">.</span>run)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># start threads</span>
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;main: starting threads&#34;</span>)
</span></span><span style="display:flex;"><span>        thread1<span style="color:#f92672">.</span>start()
</span></span><span style="display:flex;"><span>        thread2<span style="color:#f92672">.</span>start()
</span></span><span style="display:flex;"><span>        thread3<span style="color:#f92672">.</span>start()
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># wait until all threads have terminated</span>
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;main: joining threads&#34;</span>)
</span></span><span style="display:flex;"><span>        thread1<span style="color:#f92672">.</span>join()
</span></span><span style="display:flex;"><span>        thread2<span style="color:#f92672">.</span>join()
</span></span><span style="display:flex;"><span>        thread3<span style="color:#f92672">.</span>join()
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;main: all threads terminated&#34;</span>)
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;main: data.x = </span><span style="color:#e6db74">{}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>format(MyThread<span style="color:#f92672">.</span>data<span style="color:#f92672">.</span>x))
</span></span><span style="display:flex;"><span>                  
</span></span><span style="display:flex;"><span>                  
</span></span><span style="display:flex;"><span><span style="color:#75715e"># main guard</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    MyThread<span style="color:#f92672">.</span>main(sys<span style="color:#f92672">.</span>argv)</span></span></code></pre></div>
<h4 id="explanation">Explanation</h4>
<p>In this example, we are creating a static instance of the <code>MyData</code> class, attached directly to the <code>MyThread</code> class and not a particular object, which can act as a shared memory object for this example. Then, in each of the threads, we are performing this three-step process:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>y <span style="color:#f92672">=</span> MyThread<span style="color:#f92672">.</span>data<span style="color:#f92672">.</span>x
</span></span><span style="display:flex;"><span><span style="color:#75715e"># tell the OS it is ok to switch to another thread here</span>
</span></span><span style="display:flex;"><span>time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>MyThread<span style="color:#f92672">.</span>data<span style="color:#f92672">.</span>x <span style="color:#f92672">=</span> y <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span></span></span></code></pre></div>
<p>Just as we saw in the earlier example, we are reading the current value stored in <code>data.x</code> into a variable <code>y</code>. Then, we are using the <code>time.sleep(0)</code> method to tell the operating system to put this thread to sleep, but then immediately add it back to the list of threads to be scheduled on the processor. Finally, we update the value stored in <code>data.x</code> to be one larger than the value we saved earlier.</p>
<p>In effect, this is essentially the Python code needed to reproduce the example we saw earlier in this class.</p>
<h4 id="execution">Execution</h4>
<p>So, what happens when we run this code? As it turns out, sometimes we&rsquo;ll see it get a different result than the one we expect:</p>
<p><a href="#R-image-252cfbf65e4477a9cf5d7eec9a889ba3" class="lightbox-link"><img alt="Race Condition in Python" class="border lazy lightbox figure-image" loading="lazy" src="/cc410/images/10/python_race.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-252cfbf65e4477a9cf5d7eec9a889ba3"><img alt="Race Condition in Python" class="border lazy lightbox lightbox-image" loading="lazy" src="/cc410/images/10/python_race.png"></a></p>
<p>Uh oh! This is exactly what a race condition looks like in practice. In the screenshot on the right, we see that two threads set the same value into <code>data.x</code>, which means that they were running at the same time.</p>
<h2 id="python-lock">Python Lock</h2>
<p>To fix this, Python includes a <strong>lock</strong> that we can use as part of a <code>with</code> statement, which is simply a wrapper around a block of code that we&rsquo;d like to be <strong>atomic</strong>. An atomic block is one that shouldn&rsquo;t be broken apart and interrupted by other threads accessing the same object. In effect, using a <code>with</code> statement along with a lock will handle acquiring and releasing the lock for us.</p>
<p>So, in this example, we can update the <code>MyThread</code> class to have a lock:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyThread</span>:
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    data <span style="color:#f92672">=</span> MyData()
</span></span><span style="display:flex;"><span>    lock <span style="color:#f92672">=</span> threading<span style="color:#f92672">.</span>Lock()</span></span></code></pre></div>
<p>When, we can update the <code>run()</code> method to use a <code>with</code> statement:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">run</span>(self):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">3</span>):
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">with</span> MyThread<span style="color:#f92672">.</span>lock:
</span></span><span style="display:flex;"><span>                y <span style="color:#f92672">=</span> MyThread<span style="color:#f92672">.</span>data<span style="color:#f92672">.</span>x
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># tell the OS it is ok to switch to another thread here</span>
</span></span><span style="display:flex;"><span>                time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>                MyThread<span style="color:#f92672">.</span>data<span style="color:#f92672">.</span>x <span style="color:#f92672">=</span> y <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>                print(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{}</span><span style="color:#e6db74"> : data.x = </span><span style="color:#e6db74">{}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>format(self<span style="color:#f92672">.</span>__name, MyThread<span style="color:#f92672">.</span>data<span style="color:#f92672">.</span>x))
</span></span><span style="display:flex;"><span>            time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">0</span>)</span></span></code></pre></div>
<p>Here, the <code>with</code> statement acquires the <strong>lock</strong> that is associated with the <code>data</code> object in the <code>MyThread</code> class. Only one thread can hold that lock at a time, and by associating it with an object, we can easily keep track of which thread is able to access that object.</p>
<p>Now, when we execute that program, we&rsquo;ll always get the correct answer!</p>
<p><a href="#R-image-8ea835dccb3546faf30f70d254dfc92d" class="lightbox-link"><img alt="Synchronized in Python" class="border lazy lightbox figure-image" loading="lazy" src="/cc410/images/10/python_synch.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-8ea835dccb3546faf30f70d254dfc92d"><img alt="Synchronized in Python" class="border lazy lightbox lightbox-image" loading="lazy" src="/cc410/images/10/python_synch.png"></a></p>

<details open class=" box cstyle notices info">
  <summary class="box-label" tabindex="-1">
    <i class="fa-fw fas fa-info-circle"></i> 
    Not Always Random?
  </summary>
  <div class="box-content">
<p>In fact, to get the threads interleaved as shown in this screenshot, we had to add additional <code>time.sleep(0)</code> statements to the code! Otherwise, the program always seemed to schedule the threads in the same order on Codio. We cannot guarantee it will always happen like that, but it is an interesting quirk you can observe in multithreaded code. In practice, sometimes race conditions may only happen once in a million operations, making them extremely difficult to debug when they happen.</p>
  </div>
</details>

  <footer class="footline">
  </footer>
</article>
        </div>
      </main>
      
      
      
    </div>
    <script src="/cc410/js/clipboard/clipboard.min.js?1757434985" defer></script>
    <script src="/cc410/js/perfect-scrollbar/perfect-scrollbar.min.js?1757434985" defer></script>
    <script src="/cc410/js/theme.min.js?1757434985" defer></script>
  <script src="/cc410/js/embed-iframe.min.js?1757434985" defer></script>
  </body>
</html>
