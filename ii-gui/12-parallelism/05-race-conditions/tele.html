<!DOCTYPE html>

<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article" data-r-output-format="html">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.148.1">
    <meta name="generator" content="Relearn 8.0.0">
    <meta name="description" content="YouTube Video Video Materials
Unfortunately, the big takeaways we saw on the previous page have very important consequences for our multithreaded programs. One of the most common errors, and also one of the notoriously most difficult errors to debug, is a race condition.
Race Condition A race condition occurs when two threads in a program are trying to update the same value at the same time. If the operating system decides to interrupt one thread at just the wrong time, then a race condition occurs and the value could be given an incorrect value.">
    <meta name="author" content="Russell Feldhausen">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://textbooks.cs.ksu.edu/cc410/images/hero.png">
    <meta name="twitter:title" content="Race Conditions :: CC 410 Textbook">
    <meta name="twitter:description" content="YouTube Video Video Materials
Unfortunately, the big takeaways we saw on the previous page have very important consequences for our multithreaded programs. One of the most common errors, and also one of the notoriously most difficult errors to debug, is a race condition.
Race Condition A race condition occurs when two threads in a program are trying to update the same value at the same time. If the operating system decides to interrupt one thread at just the wrong time, then a race condition occurs and the value could be given an incorrect value.">
    <meta property="og:url" content="https://textbooks.cs.ksu.edu/cc410/ii-gui/12-parallelism/05-race-conditions/index.html">
    <meta property="og:site_name" content="CC 410 Textbook">
    <meta property="og:title" content="Race Conditions :: CC 410 Textbook">
    <meta property="og:description" content="YouTube Video Video Materials
Unfortunately, the big takeaways we saw on the previous page have very important consequences for our multithreaded programs. One of the most common errors, and also one of the notoriously most difficult errors to debug, is a race condition.
Race Condition A race condition occurs when two threads in a program are trying to update the same value at the same time. If the operating system decides to interrupt one thread at just the wrong time, then a race condition occurs and the value could be given an incorrect value.">
    <meta property="og:locale" content="en_us">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://textbooks.cs.ksu.edu/cc410/images/hero.png">
    <meta itemprop="name" content="Race Conditions :: CC 410 Textbook">
    <meta itemprop="description" content="YouTube Video Video Materials
Unfortunately, the big takeaways we saw on the previous page have very important consequences for our multithreaded programs. One of the most common errors, and also one of the notoriously most difficult errors to debug, is a race condition.
Race Condition A race condition occurs when two threads in a program are trying to update the same value at the same time. If the operating system decides to interrupt one thread at just the wrong time, then a race condition occurs and the value could be given an incorrect value.">
    <meta itemprop="dateModified" content="2024-06-17T14:13:48-05:00">
    <meta itemprop="wordCount" content="592">
    <meta itemprop="image" content="https://textbooks.cs.ksu.edu/cc410/images/hero.png">
    <title>Race Conditions :: CC 410 Textbook</title>
    <link href="https://textbooks.cs.ksu.edu/cc410/ii-gui/12-parallelism/05-race-conditions/index.html" rel="canonical" type="text/html" title="Race Conditions :: CC 410 Textbook">
    <link href="/cc410/ii-gui/12-parallelism/05-race-conditions/index.xml" rel="alternate" type="application/rss+xml" title="Race Conditions :: CC 410 Textbook">
    <link href="/cc410/ii-gui/12-parallelism/05-race-conditions/index.print.html" rel="alternate" type="text/html" title="Race Conditions :: CC 410 Textbook">
    <link href="/cc410/ii-gui/12-parallelism/05-race-conditions/embed.html" rel="alternate" type="text/html" title="Race Conditions :: CC 410 Textbook">
    <link href="/cc410/images/favicon.ico?1758639063" rel="icon" type="image/x-icon" sizes="any">
    <link href="/cc410/css/auto-complete/auto-complete.min.css?1758639063" rel="stylesheet">
    <script src="/cc410/js/auto-complete/auto-complete.min.js?1758639063" defer></script>
    <script src="/cc410/js/search-lunr.min.js?1758639063" defer></script>
    <script src="/cc410/js/search.min.js?1758639063" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.index_js_url="/cc410/searchindex.en.js?1758639063";
    </script>
    <script src="/cc410/js/lunr/lunr.min.js?1758639063" defer></script>
    <script src="/cc410/js/lunr/lunr.stemmer.support.min.js?1758639063" defer></script>
    <script src="/cc410/js/lunr/lunr.multi.min.js?1758639063" defer></script>
    <script src="/cc410/js/lunr/lunr.en.min.js?1758639063" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.contentLangs=['en'];
    </script>
    <link href="/cc410/fonts/fontawesome/css/fontawesome-all.min.css?1758639063" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/cc410/fonts/fontawesome/css/fontawesome-all.min.css?1758639063" rel="stylesheet"></noscript>
    <link href="/cc410/css/perfect-scrollbar/perfect-scrollbar.min.css?1758639063" rel="stylesheet">
    <link href="/cc410/css/theme.min.css?1758639063" rel="stylesheet">
    <link href="/cc410/css/format-html.min.css?1758639063" rel="stylesheet" id="R-format-style">
    <script>
      window.relearn = window.relearn || {};
      // configuration
      window.relearn.min = `.min`;
      window.relearn.path='\/ii-gui\/12-parallelism\/05-race-conditions\/index.html';
      window.relearn.relBasePath='..\/..\/..';
      window.relearn.relBaseUri='..\/..\/..\/..';
      window.relearn.absBaseUri='https:\/\/textbooks.cs.ksu.edu\/cc410';
      window.relearn.disableAnchorCopy=false;
      window.relearn.disableAnchorScrolling=false;
      window.relearn.disableInlineCopyToClipboard=true;
      window.relearn.enableBlockCodeWrap=false;
      // legal
      window.relearn.getItem = (s,n) => {return s.getItem(n)};
      window.relearn.setItem = (s,n,v) => {return s.setItem(n,v)};
      window.relearn.removeItem = (s,n) => {return s.removeItem(n)};
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
      // variant stuff
      window.relearn.themevariants = [ 'light-theme' ];
      window.relearn.customvariantname = "my-custom-variant";
      // [x] russfeld
      window.relearn.writeVariant=false;
      window.relearn.changeVariant = function(variant) {
        var oldVariant = document.documentElement.dataset.rThemeVariant;
        window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
        document.documentElement.dataset.rThemeVariant = variant;
        if (oldVariant != variant) {
          document.dispatchEvent( new CustomEvent('themeVariantLoaded', { detail: { variant, oldVariant } }) );
          window.relearn.markVariant();
        }
      }
      window.relearn.markVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant");
        document.querySelectorAll(".R-variantswitcher select").forEach((select) => {select.value = variant;});
      }
      window.relearn.initVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant") ?? "";
        if( variant == window.relearn.customvariantname ){
        }else if( !variant || !window.relearn.themevariants.includes(variant) ){
          variant = window.relearn.themevariants[0];
          
          if (window.relearn.writeVariant) {
            window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
          }
        }
        document.documentElement.dataset.rThemeVariant = variant;
      }
      window.relearn.initVariant();
      window.relearn.markVariant();
    </script>
    <link href="/cc410/css/custom.css?1758639063" rel="stylesheet">
  </head>
  <body class="mobile-support html" data-url="/cc410/ii-gui/12-parallelism/05-race-conditions/index.html">
    
    <div id="tele" class="tele mirror">
    
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      
      
      
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable ii-gui" tabindex="-1">
        <div class="flex-block-wrapper">
<article class="default">
  <header class="headline">
  </header>

<h1 id="race-conditions">Race Conditions</h1>


<a href="https://www.youtube.com/watch?v=PasqRhMjmcI">YouTube Video</a>

<p><a href="/cc410/ii-gui/12-parallelism/05-race-conditions/video/index.html">Video Materials</a></p>
<p>Unfortunately, the big takeaways we saw on the previous page have very important consequences for our multithreaded programs. One of the most common errors, and also one of the notoriously most difficult errors to debug, is a race condition.</p>
<h2 id="race-condition">Race Condition</h2>
<p>A <a href="https://en.wikipedia.org/wiki/Race_condition" rel="external" target="_blank"><strong>race condition</strong></a> occurs when two threads in a program are trying to update the same value at the same time. If the operating system decides to interrupt one thread at just the wrong time, then a race condition occurs and the value could be given an incorrect value.</p>
<p>Let&rsquo;s look at the simplest form of a race condition. Consider the case where we&rsquo;d like to read a value from a variable, and then add 1 to that value. In code, it might look something like this:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>y <span style="color:#f92672">=</span> data<span style="color:#f92672">.</span>x
</span></span><span style="display:flex;"><span>data<span style="color:#f92672">.</span>x <span style="color:#f92672">=</span> y <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span></span></span></code></pre></div>
<p>Here, we have some <code>data</code> object stored in memory, which includes an attribute of <code>x</code>. Notice that we are not just adding 1 to the value of <code>x</code> and immediately updating it. Instead, we read the value of <code>x</code> into <code>y</code>, then use <code>y</code> to increase the value of <code>x</code> by 1. This is a very arbitrary example, but it is reflective of code that we might actually use in our applications. For example, we might read the <code>x</code> coordinate position of a sprite in a video game, perform some calculation on that position, and then update the position. It follows a pattern very similar to this.</p>
<p>So, if we run this code in two separate threads, one way the program could execute is shown below:</p>
<p><a href="#R-image-91cade3c03cca4b6488dcfcbbf85051e" class="lightbox-link"><img alt="No Race Condition Threading" class="border lazy lightbox figure-image" loading="lazy" src="/cc410/images/10/thread_norace.svg" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-91cade3c03cca4b6488dcfcbbf85051e"><img alt="No Race Condition Threading" class="border lazy lightbox lightbox-image" loading="lazy" src="/cc410/images/10/thread_norace.svg"></a></p>
<p>In this case, both pieces of code work like we expect. The spawned thread goes first, and reads the value 0 from <code>data.x</code>. Then, it computes the new value 1 and stores that back in <code>data.x</code>. After that, the main thread is scheduled on the other processor, and it reads 1 from <code>data.x</code>, computers the new value 2, and stores it back in place. So far, so good, right?</p>
<p>What if the threads get interrupted during the computation? In that case, the program could instead execute like this:</p>
<p><a href="#R-image-536d70db4993c2b73d7bf515c68126c2" class="lightbox-link"><img alt="Race Condition" class="border lazy lightbox figure-image" loading="lazy" src="/cc410/images/10/thread_race.svg" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-536d70db4993c2b73d7bf515c68126c2"><img alt="Race Condition" class="border lazy lightbox lightbox-image" loading="lazy" src="/cc410/images/10/thread_race.svg"></a></p>
<p>In this case, the spawned thread reads the value 0 from <code>data.x</code>, then stores it in <code>y</code>. Then, it is interrupted on its CPU, while the main thread is scheduled to execute on the other CPU. So, that main thread will also read the value 0 from <code>data.x</code> and store it in <code>y</code>. After that, the spawned thread will run, updating the value in <code>data.x</code> to 1. Finally, the main thread will execute updating the value in <code>data.x</code> to 1 again, even though it was already 1.</p>
<p>So, as we can see, we&rsquo;ve run the same program, and it has produced two different results, depending on how the threads themselves are scheduled to run on the system. This is the essence of a race condition in our code.</p>
<p>What if both threads are scheduled to run simultaneously on two different processors, as in this example:</p>
<p><a href="#R-image-35d43e839f74c57178f389770c997d83" class="lightbox-link"><img alt="Simultaneous Threads" class="border lazy lightbox figure-image" loading="lazy" src="/cc410/images/10/thread_simul.svg" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-35d43e839f74c57178f389770c997d83"><img alt="Simultaneous Threads" class="border lazy lightbox lightbox-image" loading="lazy" src="/cc410/images/10/thread_simul.svg"></a></p>
<p>In this case, the main thread is trying to read the value of <code>data.x</code> at the exact same instant that the spawned thread is trying to save that value. In that case, what will the main thread think is stored in <code>data.x</code>? As it turns out, <em>we have no way of predicting</em> what it will read. It could read 0, or 1, or maybe even some intermediate value the CPU uses while it stores the data.</p>
<p>Thankfully, there is a way to deal with this situation, as we&rsquo;ll learn on the next page.</p>

  <footer class="footline">
  </footer>
</article>
        </div>
      </main>
      
      
      
    </div>
    <script src="/cc410/js/clipboard/clipboard.min.js?1758639063" defer></script>
    <script src="/cc410/js/perfect-scrollbar/perfect-scrollbar.min.js?1758639063" defer></script>
    <script src="/cc410/js/theme.min.js?1758639063" defer></script>
      
      
      
    </div> 
  <script src="/cc410/js/tele-scroll.min.js?1758639063" defer></script>
  </body>
</html>
