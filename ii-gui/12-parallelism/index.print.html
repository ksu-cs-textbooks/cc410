




	
	
		

	
	
		

	
	
		

	
	
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		
		

	
	
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		
		

	
	
		
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		
		
		
		

	
	
		

	
	
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		
<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.101.0">
    <meta name="generator" content="Relearn 5.18.0">
    <meta name="description" content="CC 410 Textbook">
    <meta name="author" content="Russell Feldhausen">
    <title>Parallelism :: CC 410 Textbook</title>
    <link href="https://ksu-cs-textbooks.github.io/cc410/ii-gui/12-parallelism/index.html" rel="canonical" type="text/html" title="Parallelism :: CC 410 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cc410/ii-gui/12-parallelism/index.xml" rel="alternate" type="application/rss+xml" title="Parallelism :: CC 410 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cc410/ii-gui/12-parallelism/tele.html" rel="alternate" type="text/html" title="Parallelism :: CC 410 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cc410/ii-gui/12-parallelism/embed.html" rel="alternate" type="text/html" title="Parallelism :: CC 410 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cc410/images/favicon.ico?1691701595" rel="icon" type="image/x-icon" sizes="any">
    <!-- https://github.com/filamentgroup/loadCSS/blob/master/README.md#how-to-use -->
    <link href="https://ksu-cs-textbooks.github.io/cc410/css/fontawesome-all.min.css?1691701674" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cc410/css/fontawesome-all.min.css?1691701674" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cc410/css/nucleus.css?1691701674" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cc410/css/auto-complete.css?1691701674" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cc410/css/auto-complete.css?1691701674" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cc410/css/perfect-scrollbar.min.css?1691701674" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cc410/css/fonts.css?1691701674" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cc410/css/fonts.css?1691701674" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cc410/css/theme.css?1691701674" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cc410/css/theme-auto.css?1691701674" rel="stylesheet" id="variant-style">
    <link href="https://ksu-cs-textbooks.github.io/cc410/css/variant.css?1691701674" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cc410/css/print.css?1691701674" rel="stylesheet" media="print">
    <link href="https://ksu-cs-textbooks.github.io/cc410/css/format-print.css?1691701674" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cc410/css/ie.css?1691701674" rel="stylesheet">
    <script src="https://ksu-cs-textbooks.github.io/cc410/js/url.js?1691701674"></script>
    <script src="https://ksu-cs-textbooks.github.io/cc410/js/variant.js?1691701674"></script>
    <script>
      // hack to let hugo tell us how to get to the root when using relativeURLs, it needs to be called *url= for it to do its magic:
      // https://github.com/gohugoio/hugo/blob/145b3fcce35fbac25c7033c91c1b7ae6d1179da8/transform/urlreplacers/absurlreplacer.go#L72
      window.index_js_url="https://ksu-cs-textbooks.github.io/cc410/index.search.js";
      var root_url="https://ksu-cs-textbooks.github.io/cc410/";
      var baseUri=root_url.replace(/\/$/, '');
      // translations
      window.T_Copy_to_clipboard = 'Copy to clipboard';
      window.T_Copied_to_clipboard = 'Copied to clipboard!';
      window.T_Copy_link_to_clipboard = 'Copy link to clipboard';
      window.T_Link_copied_to_clipboard = 'Copied link to clipboard!';
      window.T_No_results_found = 'No results found for \u0022{0}\u0022';
      window.T_N_results_found = '{1} results found for \u0022{0}\u0022';
      // some further base stuff
      var baseUriFull='https:\/\/ksu-cs-textbooks.github.io\/cc410/';
      window.variants && variants.init( [ 'auto', 'light-theme', 'dark-theme' ] );
    </script>
    
    <link href="https://ksu-cs-textbooks.github.io/cc410/css/custom.css?1691701674" rel="stylesheet">

  </head>
  <body class="mobile-support print disableInlineCopyToClipboard" data-url="https://ksu-cs-textbooks.github.io/cc410/ii-gui/12-parallelism/index.html">
    <div id="body" class="default-animation">
      <div id="sidebar-overlay"></div>
      <div id="toc-overlay"></div>
      <nav id="topbar" class="highlightable">
        <div>
          <div id="top-tele-link">
            <a class="print-link" title='Teleprompter View' href="https://ksu-cs-textbooks.github.io/cc410/ii-gui/12-parallelism/tele.html">
              <i class="fas fa-tv fa-fw"></i>
            </a>
          </div>
          <div id="top-embed-link">
            <a class="print-link" title='Embeddable Version' href="https://ksu-cs-textbooks.github.io/cc410/ii-gui/12-parallelism/embed.html">
              <i class="fas fa-expand-arrows-alt fa-fw"></i>
            </a>
          </div>
          <div id="breadcrumbs">
            <span id="sidebar-toggle-span">
              <a href="#" id="sidebar-toggle" class="topbar-link" title='Menu (CTRL+ALT+n)'><i class="fas fa-bars fa-fw"></i></a>
            </span>
            <ol class="links" itemscope itemtype="http://schema.org/BreadcrumbList">
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="https://ksu-cs-textbooks.github.io/cc410/index.html"><span itemprop="name">CC 410 - Advanced Programming</span></a><meta itemprop="position" content="1"> &gt; </li>
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="https://ksu-cs-textbooks.github.io/cc410/ii-gui/index.html"><span itemprop="name">GUI</span></a><meta itemprop="position" content="2"> &gt; </li>
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">Parallelism</span><meta itemprop="position" content="3"></li>
            </ol>
          </div>
        </div>
      </nav>
      <main id="body-inner" class="highlightable chapter narrow" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="chapter">
            <header class="headline">
            </header>


<div class="article-subheading">Chapter 12</div>
<h1 id="parallelism">Parallelism</h1>

<p>Running multiple threads concurrently!</p>

            <footer class="footline">

            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Parallelism</h1>
    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="introduction">Introduction</h1>

<p>Up to this point, we&rsquo;ve only been dealing with programs that run within a single <a href="https://en.wikipedia.org/wiki/Thread_%28computing%29" target="_blank"><strong>thread</strong></a>
 of execution. That means that we can follow a single path through the code, all the way from the start of the program when it calls the <code>main()</code> method all the way to the end. Unfortunately, while this allows us to create many useful programs, we aren&rsquo;t able to take advantage of the power of modern computers with <a href="https://en.wikipedia.org/wiki/Multi-core_processor" target="_blank">multi-core processors</a>
, which can handle multiple tasks simultaneously.</p>
<p>In addition, if our application needs to perform multiple tasks at once, such as computing a complex value while also handling user interactions with a GUI, we need a way to develop a program that can have multiple simultaneous paths executing at the same time. Without this, our GUI will appear to freeze anytime the application needs to compute something, frustrating our users and making it very slow to use.</p>
<p>In this chapter, we&rsquo;ll introduce the concept of <a href="https://en.wikipedia.org/wiki/Multithreading_%28computer_architecture%29" target="_blank">multithreaded computing</a>
, which involves creating a single program that can perform multiple simultaneous tasks within <strong>threads</strong>, itself a subset of the larger concept of <a href="https://en.wikipedia.org/wiki/Parallel_computing" target="_blank">parallel computing</a>
 that involves running multiple <strong>processess</strong> simultaneously, sometimes spread across large <a href="https://en.wikipedia.org/wiki/Supercomputer" target="_blank">supercomputers</a>
.</p>
<p>Some key terms we&rsquo;ll cover in this chapter:</p>
<ul>
<li>Thread</li>
<li>Process</li>
<li>Multithreading</li>
<li>Scheduling</li>
<li>Parallel</li>
<li>Thread safety</li>
<li>Shared memory</li>
<li>Race Condition</li>
</ul>
<p>We&rsquo;ll also explore a short example multithreaded program to see how it works in each of our programming languages.</p>

            <footer class="footline">

            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="processes">Processes</h1>

<p><a href="https://www.youtube.com/watch?v=aDJMUyneWKY">YouTube Video</a></p>
<p><a href="https://ksu-cs-textbooks.github.io/cc410/ii-gui/12-parallelism/02-processes/video/">Video Materials</a>
</p>
<p>First, let&rsquo;s review how modern computers actually handle running multiple applications at once, and what that means for our own programs.</p>
<h2 id="process">Process</h2>
<p>
<a href="#image-c7dc2c0a79276e5693bc55728f9cf94d" class="lightbox-link">
<img src="https://ksu-cs-textbooks.github.io/cc410/images/10/htop.png" alt="HTOP" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-c7dc2c0a79276e5693bc55728f9cf94d">
<img src="https://ksu-cs-textbooks.github.io/cc410/images/10/htop.png" alt="HTOP" class="lightbox-image" loading="lazy">
</a><sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup></p>
<p>When a program is executed on a computer, the operating system loads its code into memory and creates a <a href="https://en.wikipedia.org/wiki/Process_%28computing%29" target="_blank"><strong>process</strong></a>
 to handle running that program. A process is simply an instance of a computer program that is running, just like an object is an instance of a class. Some programs, such as a web browser, allow us to create multiple processes of the same program, usually represented by multiple windows or tabs. The image above shows the <code>htop</code> command in Linux, which lists all of the processes running on the system. In Codio, we can use the <code>top</code> command in the Terminal to see the running processes - go ahead and try it!</p>
<p>At some point during your experience working with a computer, you may have been told that a computer can only do one thing at a time, and that it appears to run multiple programs at the same time by quickly switching between them. That&rsquo;s mostly true, though in actuality there is a bit more nuance to it, which we&rsquo;ll discuss a bit later. For modern computer with multi-core processors, we can typically have one process running per core.</p>
<p>In practice, an operating system may have tens or even hundreds of processes running at any given time. However, the computer it is running on may only have four or eight processor cores available. So, the operating system includes a <strong>scheduler</strong> that determines which processes should be executed at any given time, and most operating systems will switch between running processes thousands of times per second, making it appear to a user that all running processes are executing at the same time. This process of swapping between running processes is known as <strong>context switching</strong>.</p>
<p>
<a href="#image-c684e6eff5f97142ada5dd1544e29c52" class="lightbox-link">
<img src="https://ksu-cs-textbooks.github.io/cc410/images/10/process_states.svg" alt="Process States" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-c684e6eff5f97142ada5dd1544e29c52">
<img src="https://ksu-cs-textbooks.github.io/cc410/images/10/process_states.svg" alt="Process States" class="lightbox-image" loading="lazy">
</a><sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup></p>
<p>The diagram above shows the various states a process can be placed in by the scheduler in the operating system. When the process is able to execute, it is in the <strong>running</strong> state. When the scheduler is ready to pause it, it is placed into the <strong>waiting</strong> state. However, when it is trying to load a file or waiting on another task, it is instead in the <strong>blocked</strong> state until that operation has completed.</p>
<p>When a process is <strong>waiting</strong> or <strong>blocked</strong>, the operating system could also decide that it needs to reclaim the memory used by this process. In that case, it can be <strong>swapped</strong> out of the processor&rsquo;s cache in place of another process. Of course, all of this happens at the microsecond level in modern processors, so a process can be running, waiting, blocked, swapped out of memory, and swapped back in memory, all within a single second.</p>
<p>So, in the simplest version, each program we want to run is loaded into a process by the operating system, which handles scheduling that process to run on one of the cores of our processor. That&rsquo;s what we need to know for now, as we introduce the next concept, <strong>threads</strong>.</p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p><a href="https://commons.wikimedia.org/w/index.php?title=File:Htop.png&amp;oldid=528715283" target="_blank">https://commons.wikimedia.org/w/index.php?title=File:Htop.png&oldid=528715283</a>
&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p><a href="https://commons.wikimedia.org/w/index.php?title=File:Process_states.svg&amp;oldid=508079226" target="_blank">https://commons.wikimedia.org/w/index.php?title=File:Process_states.svg&oldid=508079226</a>
&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>

            <footer class="footline">

            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Processes</h1>
    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="introduction">Introduction</h1>


<a href="https://www.youtube.com/watch?v=aDJMUyneWKY">YouTube Video</a>

<h4 id="resources">Resources</h4>
<ul>
<li><a href="https://ksu-cs-textbooks.github.io/cc410/ii-gui/12-parallelism/02-processes/video/slides/" target="_blank">Slides</a></li>
</ul>
<h4 id="video-script">Video Script</h4>
<p>In this chapter, we&rsquo;re going to take a quick detour to discuss parallelism in programming. This will help us better understand the next topic related to GUIs, which is event-driven programming. So, what is parallelism? In short, parallelism involves writing our programs in a way that they can perform multiple tasks simultaneously. We typically do this through the use of threads, contained within the process that our application is running under. This video will explain what all of that means.</p>
<p>First, let&rsquo;s look at a process. A process is simply an instance of our application that is running on a computer. While you are watching this video, you probably have several processes running on your computer, such as a web browser or two, maybe a few chat programs, or even an antivirus program. Each of these are contained within a process, which is managed and scheduled by the operating system. In short, the operating system keeps track of all the running processes, and figures out how to run them on the available computing resources, such as the number of cores on our CPU and the amount of RAM available. Finally, as we&rsquo;ll see, each individual process can contain multiple threads of execution, allowing each process to perform multiple separate tasks simultaneously.</p>
<p>If we want to explore the processes that are running on your computer, most modern operating systems provide a tool just for that purpose. In Windows, we would use the Task Manager program, shown here. This is an actual screenshot of my computer&rsquo;s task manager while I was developing this lecture. As you can see, I had several applications open, including Google Chrome, Microsoft Teams, Visual Studio Code, and even the Pandora music player. Each of these applications consists of one or more running processes, indicated by the number in parentheses. We can also see some statistics about how many of our computing resources are being consumed by each process.</p>
<p>As we stated earlier, the operating system is responsible for scheduling these processes. A modern computer typically has a processor with multiple processing cores, but typically there are many more processes running than there are cores available on the system. So, the operating system must determine which processes are allowed to run at any given time, and then it will switch between those running processes thousands of times each second. To the user, this makes it appear like all of the programs are running simultaneously, and we&rsquo;ll usually act as if they are even in theory, but in practice it is important to understand that each CPU core can typically only run one process at a time. So, if the computer only has a single processing core, then it is impossible to have anything run truly simultaneously. This diagram shows the various states that a process can be placed into by the operating system. When the process is executing on the processor, we say that it is in the &ldquo;running&rdquo; state. If the operating system decides to interrupt it and let another process run, it goes into the &ldquo;waiting&rdquo; state, meaning that it can be scheduled again by the operating system. However, if the process tries to access a file or memory that isn&rsquo;t ready, it will be placed in the &ldquo;blocked&rdquo; state until that resource is available. Once it is, then it will shift back to the &ldquo;waiting&rdquo; state, ready to be scheduled by the operating system in the future. Finally, any process that is not currently running could also be swapped out of memory, especially if there is a limited amount of memory available on the system or another process is consuming large amounts of memory. So, processes that are either &ldquo;waiting&rdquo; or &lsquo;blocked&quot; could also be &ldquo;swapped out&rdquo; of memory, and must be &ldquo;swapped in&rdquo; before they can execute again.</p>
<p>Finally, let&rsquo;s also talk about threads. Within a process, there can be one or more threads, sometimes known as &ldquo;threads of execution&rdquo; running at any given time. A thread is a connected sequence of instructions contained in the code. For example, think about tracing the execution of a program using your finger. If there is only one linear path through the code, then that application only has a single thread. Of course, if the code includes functions, recursion, or loops, it may look more complex, but you can always draw a single line that goes all the way through the code, from beginning to end. Up to this point, all of the programs we&rsquo;ve developed in this program have only had a single thread, so this is what you should be used to at this point. Each thread starts with a function call, and the main thread usually starts with the <code>main()</code> method in our code. Threads, like the processes they are contained in, are scheduled by the operating system to run on any available processor core. When a process contains multiple threads, the operating system will keep track of each individual thread as it schedules the process to execute on a core of the CPU. The biggest difference between threads and processes is that threads exist within a process, and therefore they have access to the shared memory available in the process. So, that means that multiple threads can access the same data, making them a powerful way to take large computational processes and divide them up to run faster across the many cores available in most modern computers.</p>
<p>There are also tools available to examine the running threads on your system. This is a screenshot from Process Explorer, a tool available for Windows 10 that gives more detail about each running process. In this screenshot, we can see that one of the processes for Visual Studio Code contains 28 individual threads. We can see statistics about each thread, including the actual function call used to start the thread. This is a really great way to explore the processes running on your system and better understand how they are structured.</p>
<p>As you might have guessed, writing programs that use multiple threads can add a whole new layer of complexity to our programs. In this chapter, we&rsquo;ll briefly explain some of those concerns and give you the tools to work around them.</p>

            <footer class="footline">

            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Introduction</h1>
    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id=""></h1>

<section>
    <h3>Processes & Threads</h3>
    <img class="plain stretch" src="https://ksu-cs-textbooks.github.io/cc410/images/10/410_10_thread.svg">
    <p class="imagecredit">Image Credit: <a href="https://commons.wikimedia.org/w/index.php?title=File:Multithreaded_process.svg&oldid=515934464">Wikipedia</a></p>
</section>
<section>
    <h3>Process</h3>
    <ul>
        <li>Instance of an Application</li>
        <li>Consumes Memory & CPU Time</li>
        <li>Scheduled by the OS</li>
        <li>Can Contain Multiple Threads</li>
    </ul>
</section>
<section>
    <h3>Processes</h3>
    <img class="plain stretch" src="https://ksu-cs-textbooks.github.io/cc410/images/10/410_10_taskmanager.png">
</section>
<section>
    <h3>Process States</h3>
    <img class="plain stretch" src="https://ksu-cs-textbooks.github.io/cc410/images/10/410_10_states.svg">
    <p class="imagecredit">Image Credit: <a href="https://commons.wikimedia.org/w/index.php?title=File:Process_states.svg&oldid=508079226">Wikipedia</a></p>
</section>
<section>
    <h3>Thread</h3>
    <ul>
        <li>Smallest Sequence of Instructions</li>
        <li>Scheduled by the OS</li>
        <li>Runs on a Single Core</li>
        <li>Starts With a Function Call</li>
        <li>Can Share Memory with Other Threads</li>
    </ul>
</section>
<section>
    <h3>Threads</h3>
    <img class="plain stretch" src="https://ksu-cs-textbooks.github.io/cc410/images/10/410_10_threads.png">
</section>
            <footer class="footline">

            </footer>
          </article>

          </section>
          </section>
    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="threads">Threads</h1>

<p>
<a href="#image-199033b34ca0ca0623bd6b7494e0a76e" class="lightbox-link">
<img src="https://ksu-cs-textbooks.github.io/cc410/images/10/thread.svg" alt="Thread" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-199033b34ca0ca0623bd6b7494e0a76e">
<img src="https://ksu-cs-textbooks.github.io/cc410/images/10/thread.svg" alt="Thread" class="lightbox-image" loading="lazy">
</a><sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup></p>
<p>In most modern operating systems, a process can be further divided into <strong>threads</strong>, which are individual sequences of instructions that the program can follow. A great way to think of a thread is an individual line of code that you can trace through your program, starting at the beginning and going all the way to the end. Up to this point, we&rsquo;ve only written programs that contain a single thread, so you should only be able to trace a single line of code all the way through the program.</p>
<p>However, it is possible for our program to create multiple threads, and then have them appear to run simultaneously. Of course, as we said before, they may not actually run simultaneously, especially on a computer with only a single processing core. It is all left up to the scheduler in the operating system to determine how these threads are actually scheduled and executed.</p>

  
  
<div class="box notices cstyle info">
  <div class="box-label"><i class="fa-fw fas fa-info-circle"></i> Complexity</div>
  <div class="box-content">

<p>This description leaves out some of the complexity of how threads and processes work within modern operating systems on modern hardware. In the real world, it is possible for a process to consist of multiple threads, and those threads can be scheduled to run at any time on any processor in any order by the operating system.</p>
<p>In addition, many newer processors support running multiple threads simultaneously on a single core, so threads could be running at the exact same time, maybe even on the same processor core itself.</p>
<p>We won&rsquo;t worry about any of these details in this course, since much of this is handled for us by our programming language and operating system. However, if you plan to develop truly high-performance applications that use threads, you&rsquo;ll need to learn how to properly deal with the complexity that comes from using modern computer hardware.</p>
</div>
</div>
<p>Thankfully, because of this, we can write programs that use multiple threads to perform different tasks at (nearly) the same time. To the user, it appears that our program is doing multiple things at once!</p>
<p>For our use, there are two major reasons why we would want to use multiple threads:</p>
<ol>
<li>If our program is running on a system that truly has multiple cores, we can split large calculations into multiple threads which can run simultaneously, making the calculation take less time overall.</li>
<li>If our program includes a GUI that the user is interacting with, we can run the GUI in one thread and perform calculations in other threads. In that way, the GUI won&rsquo;t appear to freeze when a calculation is occurring.</li>
</ol>
<p>In this chapter, we&rsquo;re going to learn about both uses, but going forward we&rsquo;re most concerned about the second use, making our GUI appear to be responsive even while our program is performing other tasks. In a later chapter, we&rsquo;ll learn about <strong>event-driven programming</strong>, which relies on splitting a program into multiple threads as well.</p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p><a href="https://commons.wikimedia.org/w/index.php?title=File:Multithreaded_process.svg&amp;oldid=515934464" target="_blank">https://commons.wikimedia.org/w/index.php?title=File:Multithreaded_process.svg&oldid=515934464</a>
&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>

            <footer class="footline">

            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="creating-threads">Creating Threads</h1>

<p><a href="https://www.youtube.com/watch?v=CmbtJtrAOH8">YouTube Video</a></p>
<p><a href="https://ksu-cs-textbooks.github.io/cc410/ii-gui/12-parallelism/04-creating-threads/video/">Video Materials</a>
</p>
<p>Now that we&rsquo;ve learned about threads, let&rsquo;s discuss how we can work with them in our programs. Writing a multithreaded program can be significantly more difficult than a single threaded program, but with the extra difficulty comes the ability to write programs that are much more flexible and powerful.</p>
<h2 id="creating-a-thread">Creating a Thread</h2>
<p>Creating a thread is very simple in many modern programming languages. Both Java and Python include libraries for dealing with threads, and to create a new thread, each one simply requires some sort of function or method to serve as the starting point for the new thread. In a way, this is just like the <code>main()</code> method that is the starting point of most programs - we&rsquo;re just defining a new method to serve as the starting point for a new thread.</p>
<p>Once we&rsquo;ve created the thread, it is given to the operating system for scheduling. Our main thread can continue to work, and the newly created thread will also start to run as well. So, the theoretical model might look something like this:</p>
<p>
<a href="#image-639df9e241573e420c7536318b6ad2a5" class="lightbox-link">
<img src="https://ksu-cs-textbooks.github.io/cc410/images/10/thread1.svg" alt="Thread Model" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-639df9e241573e420c7536318b6ad2a5">
<img src="https://ksu-cs-textbooks.github.io/cc410/images/10/thread1.svg" alt="Thread Model" class="lightbox-image" loading="lazy">
</a></p>
<p>Here, it appears that both threads are running simultaneously. However, as we discussed earlier in this chapter, that isn&rsquo;t really the case. For example, if the system only has one processor core, and these are the only two threads running on the system, then the threads might be interleaved on that processor like this:</p>
<p>
<a href="#image-4e809e0d8268077193c486bf680498e7" class="lightbox-link">
<img src="https://ksu-cs-textbooks.github.io/cc410/images/10/thread2.svg" alt="Single Core" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-4e809e0d8268077193c486bf680498e7">
<img src="https://ksu-cs-textbooks.github.io/cc410/images/10/thread2.svg" alt="Single Core" class="lightbox-image" loading="lazy">
</a></p>
<p>If we expand that to two processor cores, then they might actually run simultaneously, like this:</p>
<p>
<a href="#image-caf7783138686f2c1eb737e0bba4e369" class="lightbox-link">
<img src="https://ksu-cs-textbooks.github.io/cc410/images/10/thread3.svg" alt="Dual Core" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-caf7783138686f2c1eb737e0bba4e369">
<img src="https://ksu-cs-textbooks.github.io/cc410/images/10/thread3.svg" alt="Dual Core" class="lightbox-image" loading="lazy">
</a></p>
<p>Of course, this is a <em>very</em> simplified view of this process. In practice, there will be many processes and threads that are competing for access across several cores, so the actual model could look something like this:</p>
<p>
<a href="#image-96324ff6c0581d728f1cfbf75e8a3669" class="lightbox-link">
<img src="https://ksu-cs-textbooks.github.io/cc410/images/10/thread4.svg" alt="Threading Model" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-96324ff6c0581d728f1cfbf75e8a3669">
<img src="https://ksu-cs-textbooks.github.io/cc410/images/10/thread4.svg" alt="Threading Model" class="lightbox-image" loading="lazy">
</a></p>
<p>As we can see, the processors are always executing some code, but many times they are executing code in a thread from some other application. Our application&rsquo;s code will be scheduled by the operating system in between the other threads, but we cannot guarantee when it will be scheduled or for how long. Also, while this diagram makes it appear that each thread will only be scheduled on one processor, in fact the thread could be scheduled on ANY processor that is available. On a modern personal computer today, there may be as many as 16 or 32 individual threads available, sometimes multiple threads per CPU core, in the processor!</p>
<p>So, the big takeaways here:</p>
<ol>
<li>Our application can create threads, which start by running code in a function specified when the thread is created.</li>
<li>The operating system will schedule our threads across the available cores in the CPU.</li>
<li>We cannot predict or control when the threads will be scheduled to run.</li>
<li>We cannot predict or control how long the threads will run.</li>
<li>We cannot predict or control when the threads will be interrupted by another thread.</li>
</ol>

            <footer class="footline">

            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Creating Threads</h1>
    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="scheduling">Scheduling</h1>


<a href="https://www.youtube.com/watch?v=CmbtJtrAOH8">YouTube Video</a>

<h4 id="resources">Resources</h4>
<ul>
<li><a href="https://ksu-cs-textbooks.github.io/cc410/ii-gui/12-parallelism/04-creating-threads/video/slides/" target="_blank">Slides</a></li>
</ul>
<h4 id="video-script">Video Script</h4>
<p>Let&rsquo;s look a bit deeper at how the operating system handles scheduling multiple threads within a process and what impacts that might have on our code. First, let&rsquo;s start with the theoretical process model shown here. This is a very simplistic view of how two processes might run in parallel, but it hides many of the important details regarding how these two processes might execute on a computer. First, we see our process&rsquo;s main thread begin with the <code>main()</code> method. Then, inside of the main method, we create a new thread, and call it&rsquo;s <code>start()</code> method to cause that thread to be placed in the &ldquo;waiting&rdquo; state, ready for the operating system to schedule it to run. Once it does, then both threads can work independently and in parallel, hence the term &ldquo;parallel programming.&rdquo;</p>
<p>Now, let&rsquo;s see what this theoretical model might look like on a computer that has just a single CPU core. While this might seem unrealistic, remember that there are still many small devices such as watches that only have a single processor, and even today many of the shared systems in the cloud only give users access to a single processing core at a time. So, this model may actually make sense for those systems. In this diagram, we start at the top, and then time moves forward as we move down the diagram, just like before. However, now we are representing the CPU as the box down the middle, and each thread is allowed to execute on the CPU when its box overlaps with the CPU box. Starting at the top, we load our application and start in the <code>main()</code> method, which will create and start a new thread. In this example, the operating system immediately decides to switch to that new thread, so the main thread is put into the &ldquo;waiting&rdquo; state and the spawned thread is scheduled to run. It will compute for a while, but eventually the operating system will decide to interrupt it and switch back to the main thread. On most modern systems, the spawned thread will only run for a few microseconds, but that might cover thousands or more individual CPU cycles. So, the operating system will switch back and forth between these two threads until they are both finished.</p>
<p>The model becomes a bit more complex when we expand it to cover multiple CPUs. Here, we are showing two different CPUs, and that each thread only runs on its own CPU core. However, in practice, threads may switch between any of the available CPU cores at any time, so even this is leaving out a few details. However, such a diagram would be overly complex for our needs in this course, so we&rsquo;ll leave that part out. Here, we can see that the main thread starts on CPU 1, and as soon as it spawns a second thread, that threads can execute on CPU 2. This is the power of multithreaded, or parallel, programming. By taking advantage of multiple CPU cores, our application can perform multiple computations simultaneously, making the entire application appear to run much faster. And, in practice, parallel programming done correctly can indeed result in programs that run much faster on modern computer systems.</p>
<p>Of course, there is one other thing we have to keep in mind. On most computer systems, there are potentially hundreds or thousands of threads that all need access to just a few CPU cores. So, our threads aren&rsquo;t the only ones that are being scheduled to run on the CPUs. Here, we can see how our threads can be constantly interrupted by other threads that are scheduled by the operating system. And, our threads may be moved between processors as well, though again we are just focusing on this simple 2 CPU model for now. As we see here, our threads still run in parallel, but there is no real guarantee that they will not be interrupted while performing their work. They will still appear to run faster to the user, but they are not running 100% of the time.</p>
<p>So, what is the big takeaway from all of this. In short, we must always remember that the operating system is in control, not the programmer. Because of that, we can neither predict, nor control, when our threads are executed, which core they are executed on, how long they will run, or when they will be interrupted. This means that we really don&rsquo;t know much of ANYTHING about how our threads may actually execute, so instead we&rsquo;ll have to write our code in a way that will guarantee success no matter what happens. The rest of this chapter will introduce the classic form of an error in parallel programming, the race condition, and give us one possible way to solve it.</p>

            <footer class="footline">

            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Scheduling</h1>
    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id=""></h1>

<section>
    <h3>Theoretical Model</h3>
    <img class="plain stretch" src="https://ksu-cs-textbooks.github.io/cc410/images/10/410_10_schedule1.svg">
</section>
<section>
    <h3>Single CPU</h3>
    <img class="plain stretch" src="https://ksu-cs-textbooks.github.io/cc410/images/10/410_10_schedule2.svg">
</section>
<section>
    <h3>Multiple CPUs</h3>
    <img class="plain stretch" src="https://ksu-cs-textbooks.github.io/cc410/images/10/410_10_schedule3.svg">
</section>
<section>
    <h3>Other Threads</h3>
    <img class="plain stretch" src="https://ksu-cs-textbooks.github.io/cc410/images/10/410_10_schedule4.svg">
</section>
<section>
    <h3>Takeaways</h3>
    <ul>
        <li>The OS is in Control</li>
        <li>We cannot predict or control:<ul>
            <li>When a thread will run</li>
            <li>How long a thread will run</li>
            <li>When a thread will be interrupted</li>
        </ul>
        <li>We must plan for all scenarios</li>
    </ul>
</section>
            <footer class="footline">

            </footer>
          </article>

          </section>
          </section>
    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="race-conditions">Race Conditions</h1>

<p><a href="https://www.youtube.com/watch?v=PasqRhMjmcI">YouTube Video</a></p>
<p><a href="https://ksu-cs-textbooks.github.io/cc410/ii-gui/12-parallelism/05-race-conditions/video/">Video Materials</a>
</p>
<p>Unfortunately, the big takeaways we saw on the previous page have very important consequences for our multithreaded programs. One of the most common errors, and also one of the notoriously most difficult errors to debug, is a race condition.</p>
<h2 id="race-condition">Race Condition</h2>
<p>A <a href="https://en.wikipedia.org/wiki/Race_condition" target="_blank"><strong>race condition</strong></a>
 occurs when two threads in a program are trying to update the same value at the same time. If the operating system decides to interrupt one thread at just the wrong time, then a race condition occurs and the value could be given an incorrect value.</p>
<p>Let&rsquo;s look at the simplest form of a race condition. Consider the case where we&rsquo;d like to read a value from a variable, and then add 1 to that value. In code, it might look something like this:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>y <span style="color:#f92672">=</span> data<span style="color:#f92672">.</span>x
</span></span><span style="display:flex;"><span>data<span style="color:#f92672">.</span>x <span style="color:#f92672">=</span> y <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span></span></span></code></pre></div><p>Here, we have some <code>data</code> object stored in memory, which includes an attribute of <code>x</code>. Notice that we are not just adding 1 to the value of <code>x</code> and immediately updating it. Instead, we read the value of <code>x</code> into <code>y</code>, then use <code>y</code> to increase the value of <code>x</code> by 1. This is a very arbitrary example, but it is reflective of code that we might actually use in our applications. For example, we might read the <code>x</code> coordinate position of a sprite in a video game, perform some calculation on that position, and then update the position. It follows a pattern very similar to this.</p>
<p>So, if we run this code in two separate threads, one way the program could execute is shown below:</p>
<p>
<a href="#image-93dbcde003252ffee87c8fc17f40a085" class="lightbox-link">
<img src="https://ksu-cs-textbooks.github.io/cc410/images/10/thread_norace.svg" alt="No Race Condition Threading" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-93dbcde003252ffee87c8fc17f40a085">
<img src="https://ksu-cs-textbooks.github.io/cc410/images/10/thread_norace.svg" alt="No Race Condition Threading" class="lightbox-image" loading="lazy">
</a></p>
<p>In this case, both pieces of code work like we expect. The spawned thread goes first, and reads the value 0 from <code>data.x</code>. Then, it computes the new value 1 and stores that back in <code>data.x</code>. After that, the main thread is scheduled on the other processor, and it reads 1 from <code>data.x</code>, computers the new value 2, and stores it back in place. So far, so good, right?</p>
<p>What if the threads get interrupted during the computation? In that case, the program could instead execute like this:</p>
<p>
<a href="#image-875ab1baee285ed84ad4f2dd58f77437" class="lightbox-link">
<img src="https://ksu-cs-textbooks.github.io/cc410/images/10/thread_race.svg" alt="Race Condition" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-875ab1baee285ed84ad4f2dd58f77437">
<img src="https://ksu-cs-textbooks.github.io/cc410/images/10/thread_race.svg" alt="Race Condition" class="lightbox-image" loading="lazy">
</a></p>
<p>In this case, the spawned thread reads the value 0 from <code>data.x</code>, then stores it in <code>y</code>. Then, it is interrupted on its CPU, while the main thread is scheduled to execute on the other CPU. So, that main thread will also read the value 0 from <code>data.x</code> and store it in <code>y</code>. After that, the spawned thread will run, updating the value in <code>data.x</code> to 1. Finally, the main thread will execute updating the value in <code>data.x</code> to 1 again, even though it was already 1.</p>
<p>So, as we can see, we&rsquo;ve run the same program, and it has produced two different results, depending on how the threads themselves are scheduled to run on the system. This is the essence of a race condition in our code.</p>
<p>What if both threads are scheduled to run simultaneously on two different processors, as in this example:</p>
<p>
<a href="#image-aa9b96a2242085a89312610e72d91bff" class="lightbox-link">
<img src="https://ksu-cs-textbooks.github.io/cc410/images/10/thread_simul.svg" alt="Simultaneous Threads" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-aa9b96a2242085a89312610e72d91bff">
<img src="https://ksu-cs-textbooks.github.io/cc410/images/10/thread_simul.svg" alt="Simultaneous Threads" class="lightbox-image" loading="lazy">
</a></p>
<p>In this case, the main thread is trying to read the value of <code>data.x</code> at the exact same instant that the spawned thread is trying to save that value. In that case, what will the main thread think is stored in <code>data.x</code>? As it turns out, <em>we have no way of predicting</em> what it will read. It could read 0, or 1, or maybe even some intermediate value the CPU uses while it stores the data.</p>
<p>Thankfully, there is a way to deal with this situation, as we&rsquo;ll learn on the next page.</p>

            <footer class="footline">

            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Race Conditions</h1>
    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="race-conditions">Race Conditions</h1>


<a href="https://www.youtube.com/watch?v=PasqRhMjmcI">YouTube Video</a>

<h4 id="resources">Resources</h4>
<ul>
<li><a href="https://ksu-cs-textbooks.github.io/cc410/ii-gui/12-parallelism/05-race-conditions/video/slides/" target="_blank">Slides</a></li>
</ul>
<h4 id="video-script">Video Script</h4>
<p>Let&rsquo;s take a look at a situation where two threads are trying to modify the same data structure and see how this could possibly lead to one of the major pitfalls of parallel programming - a race condition. Here, we are continuing our diagrams from the previous example, but now we&rsquo;ve added a box in the middle to represent the shared <code>data</code> object, which is contained in the shared memory of the process that our application is running under. So, our main thread stars by creating the shared <code>data</code> object, and then creating and starting a new thread.</p>
<p>So, we&rsquo;ll place our second thread on the second CPU in this diagram. Of course, as I&rsquo;ve explained a few times already, this is oversimplifying things a bit - our threads could be scheduled on any processor at all, but this diagram just shows that they could be scheduled on any arbitrary processor.</p>
<p>In this diagram, we&rsquo;ll assume that the main thread is interrupted on CPU 1, so it is placed in the waiting state. At the same time, our spawned thread on CPU 2 will start performing its computation. So, it will read the value from <code>data.x</code> and store it in the local variable <code>y</code>. Then, it will store the result of adding 1 to the value in <code>y</code> back in <code>data.x</code>. We do this in a two step process to allow it to be interrupted by the operating system, as we&rsquo;ll see later.</p>
<p>Next, the spawned thread is interrupted, and the main thread is scheduled to execute. So, it will also perform its computation, eventually storing the value <code>2</code> in <code>data.x</code>. That&rsquo;s the expected output for this program, so we should see that result no matter how it executes.</p>
<p>Let&rsquo;s look at another example. It starts the same way, with the main thread.</p>
<p>Then, it spawns a second thread.</p>
<p>And, once again, the spawned thread starts to execute by storing the value <code>0</code> from <code>data.x</code> in the variable <code>y</code>.</p>
<p>However, as soon as it had completed that operation, the operating system could decide to interrupt that thread and place it in the &ldquo;waiting&rdquo; status. Meanwhile, the main thread could be scheduled to execute, and it will start its work by reading the value <code>0</code> from <code>data.x</code> and storing it in its own local variable <code>y</code>.</p>
<p>Unfortunately, once again the operating system jumps in and interrupts the main thread, but allows the spawned thread to start working again. So, it will read the value <code>0</code> stored in <code>y</code>, add <code>1</code> to it, and then storing that value back in <code>data.x</code>. So, <code>data.x</code> now stores the value 1.</p>
<p>After that, when the main thread starts again, it still has the value <code>0</code> stored in <code>y</code>. So, it will also write the value <code>1</code> to <code>data.x</code>. Uh oh! This is a problem, because now our program has run the exact same code, but achieved the wrong answer. This is because our program is written in a way that each thread could be interrupted between when it reads a value from the shared memory and when it is able to write it. While this example may seem a bit contrived, as we could just read and update the value in a single line of code, there are many instances where we&rsquo;ll read a value, perform some computation on it, and then write that value a bit later. So, if we aren&rsquo;t careful, we could run into a situation where two threads accidentally store the wrong value.</p>
<p>There is an even bigger problem we&rsquo;ll have to consider. What if the threads are truly executing at the same time? In that case, we&rsquo;ll start like before.</p>
<p>Then create our second thread.</p>
<p>And then that thread will read the value <code>0</code> from <code>data.x</code> and store it to <code>y</code>.</p>
<p>Next, that thread will store the updated value <code>1</code> in <code>data.x</code>.</p>
<p>Meanwhile, on CPU 1, the operating system might schedule our main thread to run at the exact same time. So, while our spawned thread is writing the value <code>1</code> to <code>data.x</code>, our main thread is trying to read that same value at the same time. So, what would happen in that case? Honestly, there is no way of knowing. Most likely, our main thread will either read <code>0</code> or <code>1</code>, but if our CPU decides to write any intermediate values to <code>data.x</code> while updating it, we could read one of those values instead. So, we really cannot predict what would happen in this case.</p>
<p>Of course, that means that, when the main thread updates the value in <code>data.x</code>, we have no way of predicting what value will be stored.</p>
<p>So, the core essence of a race condition is the fact that we cannot really predict what value will be stored in our shared variable when two threads execute simultaneously. Because those threads can be executed in any order, when they try to update the shared value, they could easily conflict with each other and produce an incorrect result. So, to truly be able to write multi-threaded programs, we need a way to prevent multiple threads from accessing the same variables at the same time. In the next video, we&rsquo;ll discuss one way to do that, through the use of locks.</p>

            <footer class="footline">

            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Race Conditions</h1>
    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id=""></h1>

<section>
    <img class="plain stretch" src="https://ksu-cs-textbooks.github.io/cc410/images/10/410_10_race1_1.svg">
</section>
<section>
    <img class="plain stretch" src="https://ksu-cs-textbooks.github.io/cc410/images/10/410_10_race1_2.svg">
</section>
<section>
    <img class="plain stretch" src="https://ksu-cs-textbooks.github.io/cc410/images/10/410_10_race1_3.svg">
</section>
<section>
    <img class="plain stretch" src="https://ksu-cs-textbooks.github.io/cc410/images/10/410_10_race1.svg">
</section>
<section>
    <img class="plain stretch" src="https://ksu-cs-textbooks.github.io/cc410/images/10/410_10_race2_1.svg">
</section>
<section>
    <img class="plain stretch" src="https://ksu-cs-textbooks.github.io/cc410/images/10/410_10_race2_2.svg">
</section>
<section>
    <img class="plain stretch" src="https://ksu-cs-textbooks.github.io/cc410/images/10/410_10_race2_3.svg">
</section>
<section>
    <img class="plain stretch" src="https://ksu-cs-textbooks.github.io/cc410/images/10/410_10_race2_4.svg">
</section>
<section>
    <img class="plain stretch" src="https://ksu-cs-textbooks.github.io/cc410/images/10/410_10_race2_5.svg">
</section>
<section>
    <img class="plain stretch" src="https://ksu-cs-textbooks.github.io/cc410/images/10/410_10_race2.svg">
</section>
<section>
    <img class="plain stretch" src="https://ksu-cs-textbooks.github.io/cc410/images/10/410_10_race3_1.svg">
</section>
<section>
    <img class="plain stretch" src="https://ksu-cs-textbooks.github.io/cc410/images/10/410_10_race3_2.svg">
</section>
<section>
    <img class="plain stretch" src="https://ksu-cs-textbooks.github.io/cc410/images/10/410_10_race3_3.svg">
</section>
<section>
    <img class="plain stretch" src="https://ksu-cs-textbooks.github.io/cc410/images/10/410_10_race3_4.svg">
</section>
<section>
    <img class="plain stretch" src="https://ksu-cs-textbooks.github.io/cc410/images/10/410_10_race3_5.svg">
</section>
<section>
    <img class="plain stretch" src="https://ksu-cs-textbooks.github.io/cc410/images/10/410_10_race3.svg">
</section>
<section>
    <h3>Race Conditions</h3>
    <ul>
        <li>Two Threads with Shared Memory Try to Change Values at Same Time</li>
        <li>Threads can Execute in Any Order</li>
        <li>Need Some Way to Prevent Multiple Threads Accessing Same Value</li>
    </ul>
</section>
            <footer class="footline">

            </footer>
          </article>

          </section>
          </section>
    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="thread-synchronization">Thread Synchronization</h1>

<p><a href="https://www.youtube.com/watch?v=zJRpJxICl-s">YouTube Video</a></p>
<p><a href="https://ksu-cs-textbooks.github.io/cc410/ii-gui/12-parallelism/06-thread-synchronization/video/">Video Materials</a>
</p>
<p>To deal with race conditions, we have to somehow synchronize our threads so that only one is able to update the value of a shared variable at once. There are many ways to do this, and they all fit under the banner of <strong>thread synchronization</strong>.</p>
<h2 id="locks">Locks</h2>
<p>The simplest way to do this is via a special programming construct called a <strong>lock</strong>. A <a href="https://en.wikipedia.org/wiki/Lock_%28computer_science%29" target="_blank">lock</a>
 can be thought of as a single object in memory that, when a thread has <strong>acquired</strong> the lock, it can access the shared memory protected by the lock. Once it is done, then it can <strong>release</strong> the lock, allowing another thread to acquire it.</p>
<p>A great way to think about this passing a ball around a circle of people, but only the person with the ball can speak. So, if you want to speak, you try to acquire the ball. Once you&rsquo;ve acquired it, you can speak and everyone else must listen. Then, when you are done, you can release the ball and let someone else acquire it.</p>
<p>Of course, if someone decides to hold on to the ball the entire time and not release it, then nobody else is allowed to speak. When that happens, we call that situation <strong>deadlock</strong>. The same thing can happen with a multithreaded program.</p>
<p>So, let&rsquo;s update our program to use a lock. In this case, we&rsquo;ll assume that <code>data</code> includes another attribute <code>lock</code> which contains a lock that is used to control access to <code>data</code>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>data<span style="color:#f92672">.</span>lock<span style="color:#f92672">.</span>acquire()
</span></span><span style="display:flex;"><span>y <span style="color:#f92672">=</span> data<span style="color:#f92672">.</span>x
</span></span><span style="display:flex;"><span>data<span style="color:#f92672">.</span>x <span style="color:#f92672">=</span> y <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>data<span style="color:#f92672">.</span>lock<span style="color:#f92672">.</span>release()</span></span></code></pre></div><p>Now, let&rsquo;s look at our two possible situations and see how they change when we include a lock in our code. First, we have the situation where the programs are properly interleaved:</p>
<p>
<a href="#image-73aa40d4df0ec64bb7fab7d9e694fe02" class="lightbox-link">
<img src="https://ksu-cs-textbooks.github.io/cc410/images/10/thread_norace_lock.svg" alt="Thread No Race with Lock" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-73aa40d4df0ec64bb7fab7d9e694fe02">
<img src="https://ksu-cs-textbooks.github.io/cc410/images/10/thread_norace_lock.svg" alt="Thread No Race with Lock" class="lightbox-image" loading="lazy">
</a></p>
<p>In this case, the spawned thread is able to acquire the lock when needed, perform its computation, and then release the lock before the other thread needs it. So, the lock really didn&rsquo;t change anything here.</p>
<p>However, in the next case, where they are interleaved, we&rsquo;ll see a difference:</p>
<p>
<a href="#image-b872b9b852921fecc690e62567507c23" class="lightbox-link">
<img src="https://ksu-cs-textbooks.github.io/cc410/images/10/thread_race_lock.svg" alt="Thread Race With Lock" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-b872b9b852921fecc690e62567507c23">
<img src="https://ksu-cs-textbooks.github.io/cc410/images/10/thread_race_lock.svg" alt="Thread Race With Lock" class="lightbox-image" loading="lazy">
</a></p>
<p>Here, the spawned thread immediately acquires the lock and reads the value of <code>data.x</code> into <code>y</code>, but then it is interrupted. At that same time, the main thread wakes up and starts running, and tries to acquire the lock. When this happens, the operating system will <strong>block</strong> the main thread until the lock has been released. So, instead of waiting, the main thread will be blocked, and the spawned thread will continue to do its work. However, once the spawned thread releases the lock, the operating system will wake up the main thread and allow it to acquire the lock itself. Then, the main thread can perform its computation and update the value in <code>data.x</code>. As we can see, we now get the same value that we had previously. This is good! This means that we&rsquo;ve come up with a way to defeat the inherent unpredictability in multithreaded programs.</p>
<p>The same holds for the third example on the previous page, when both threads run simultaneously. If both threads try to acquire the lock at the same time, the operating system will determine which thread gets it, and block any other threads trying to access the lock until it is released.</p>
<p>Of course, this introduces another interesting concept - if our threads must share data in this way, then is this any better than just having a single thread? If we look at this example, it seems that the threads can only run sequentially because of the lock, and that is true here. So, to make our multithreaded programs effective, each thread must be able to perform work that is independent of the other threads and any shared memory. Otherwise, the program will be even more inefficient than if we&rsquo;d just written it as a single thread!</p>
<p>On the next pages, we&rsquo;ll explore the basics of creating and using threads in both Java and Python. As always, feel free to skip ahead to the language you are learning, but you may wish to review both languages to see how they compare.</p>

            <footer class="footline">

            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Thread Synchronization</h1>
    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="locks">Locks</h1>


<a href="https://www.youtube.com/watch?v=zJRpJxICl-s">YouTube Video</a>

<h4 id="resources">Resources</h4>
<ul>
<li><a href="https://ksu-cs-textbooks.github.io/cc410/ii-gui/12-parallelism/06-thread-synchronization/video/slides/" target="_blank">Slides</a></li>
</ul>
<h4 id="video-script">Video Script</h4>
<p>In the previous video, we saw how two threads could cause issues if they tried to modify a shared variable at the same time. In this video, we&rsquo;ll explore how we can modify our code to use locks, preventing the two threads from conflicting with each other. First, we&rsquo;ll start with the same setup as always - our main thread will start, and then it will create a new thread and start it.</p>
<p>So, we&rsquo;ll see our new thread get scheduled to execute by the operating system.</p>
<p>When that thread starts running, the first thing it will do is try to acquire the shared lock protecting the <code>data</code> object in memory. Meanwhile, the main thread was interrupted, so it is in the waiting state.</p>
<p>Since no other threads have acquired the lock, our spawned thread will be able to acquire and hold the lock. We&rsquo;ll show that in this diagram with the green square. When a thread holds that lock, it is the only thread that is able to access and modify the <code>data</code> object.</p>
<p>So, our thread can quickly read the value in <code>data.x</code> and then update it with the new value.</p>
<p>Finally, once our thread is done working with <code>data</code>, it can release the lock. That will allow another thread to access that value if needed. Its always important to remember to release a lock as soon as we are done with it - if we don&rsquo;t, we could possibly cause our program to lock up due to <strong>deadlock</strong>.</p>
<p>Now, in the main thread, we can also acquire the lock.</p>
<p>Since it is not currently being held by any thread, we are able to acquire it.</p>
<p>Like before, our main thread can quickly read the value in <code>data.x</code> and update it without worrying about any other thread interrupting it.</p>
<p>Finally, once the main thread is done working with the <code>data</code> object, it can also release the lock. So, as we can see, adding the lock really doesn&rsquo;t change anything when the two threads don&rsquo;t try to run at the same time.</p>
<p>Now, let&rsquo;s look at the situation where the threads to actually execute at the same time. Like before, we&rsquo;ll start by creating our second thread.</p>
<p>That thread will try to acquire the lock. Since it is not held by any other thread&hellip;</p>
<p>the spawned thread will acquire the lock.</p>
<p>Next, it will read the value from <code>data.x</code> and store it in <code>y</code>. We&rsquo;re doing good so far.</p>
<p>Now, what if the main thread is scheduled to execute on another CPU at the same time? In that case, the first thing it will do is try to acquire the lock. Unfortunately, that lock is currently held by the other thread&hellip;</p>
<p>So the operating system will block the main thread until the lock is released! This means our lock is working as intended - the main thread is now unable to be scheduled again until the lock is released by the spawned thread.</p>
<p>So, back in the spawned thread, it can complete its work and store a new value in <code>data.x</code>.</p>
<p>And then it can release the lock.</p>
<p>As soon as it does, the operating system will switch the main thread back to the waiting state, and allow it to be scheduled again. When the main thread is scheduled, it will try to acquire the lock again, and this time it is able to get it. So, the main thread now holds the lock.</p>
<p>At that point, the main thread can perform its computation and store the updated result in <code>data.x</code>. As we can see , it gets the correct value!</p>
<p>Finally, the main thread can release the lock, and our program can continue running like normal.</p>
<p>So, as we&rsquo;ve seen, using a lock to synchronize access to a shared data object between two threads works really simply. First, the thread must acquire the lock for the object it wishes to modify. Once it does, it can perform work on the object. If any other thread tries to acquire the same lock while it is held, that thread will be blocked until the lock is released. Finally, once the thread is done, it can release the lock and allow another thread to access the shared object.</p>
<p>Of course, as we warned earlier, it is very important for threads to release locks as soon as they are done - otherwise, we could reach a situation where <strong>deadlock</strong> occurs. This happens when all of our threads are blocked from running, and our whole program freezes up.</p>
<p>I hope this quick introduction to parallel programming was interesting. In the next chapter, we&rsquo;ll learn how to use multiple threads in our GUI-based programs to make them responsive while the rest of the application is still running in the background. This is a core idea behind event-driven programming, a common paradigm used with graphical programs.</p>

            <footer class="footline">

            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Locks</h1>
    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id=""></h1>

<section>
    <img class="plain stretch" src="https://ksu-cs-textbooks.github.io/cc410/images/10/410_10_lock1_1.svg">
</section>
<section>
    <img class="plain stretch" src="https://ksu-cs-textbooks.github.io/cc410/images/10/410_10_lock1_2.svg">
</section>
<section>
    <img class="plain stretch" src="https://ksu-cs-textbooks.github.io/cc410/images/10/410_10_lock1_3.svg">
</section>
<section>
    <img class="plain stretch" src="https://ksu-cs-textbooks.github.io/cc410/images/10/410_10_lock1_4.svg">
</section>
<section>
    <img class="plain stretch" src="https://ksu-cs-textbooks.github.io/cc410/images/10/410_10_lock1_5.svg">
</section>
<section>
    <img class="plain stretch" src="https://ksu-cs-textbooks.github.io/cc410/images/10/410_10_lock1_6.svg">
</section>
<section>
    <img class="plain stretch" src="https://ksu-cs-textbooks.github.io/cc410/images/10/410_10_lock1_7.svg">
</section>
<section>
    <img class="plain stretch" src="https://ksu-cs-textbooks.github.io/cc410/images/10/410_10_lock1_8.svg">
</section>
<section>
    <img class="plain stretch" src="https://ksu-cs-textbooks.github.io/cc410/images/10/410_10_lock1_9.svg">
</section>
<section>
    <img class="plain stretch" src="https://ksu-cs-textbooks.github.io/cc410/images/10/410_10_lock1.svg">
</section>
<section>
    <img class="plain stretch" src="https://ksu-cs-textbooks.github.io/cc410/images/10/410_10_lock2_1.svg">
</section>
<section>
    <img class="plain stretch" src="https://ksu-cs-textbooks.github.io/cc410/images/10/410_10_lock2_2.svg">
</section>
<section>
    <img class="plain stretch" src="https://ksu-cs-textbooks.github.io/cc410/images/10/410_10_lock2_3.svg">
</section>
<section>
    <img class="plain stretch" src="https://ksu-cs-textbooks.github.io/cc410/images/10/410_10_lock2_4.svg">
</section>
<section>
    <img class="plain stretch" src="https://ksu-cs-textbooks.github.io/cc410/images/10/410_10_lock2_5.svg">
</section>
<section>
    <img class="plain stretch" src="https://ksu-cs-textbooks.github.io/cc410/images/10/410_10_lock2_6.svg">
</section>
<section>
    <img class="plain stretch" src="https://ksu-cs-textbooks.github.io/cc410/images/10/410_10_lock2_7.svg">
</section>
<section>
    <img class="plain stretch" src="https://ksu-cs-textbooks.github.io/cc410/images/10/410_10_lock2_8.svg">
</section>
<section>
    <img class="plain stretch" src="https://ksu-cs-textbooks.github.io/cc410/images/10/410_10_lock2_9.svg">
</section>
<section>
    <img class="plain stretch" src="https://ksu-cs-textbooks.github.io/cc410/images/10/410_10_lock2_10.svg">
</section>
<section>
    <img class="plain stretch" src="https://ksu-cs-textbooks.github.io/cc410/images/10/410_10_lock2.svg">
</section>
<section>
    <h3>Thread Synchronization</h3>
    <ul>
        <li>Thread Acquires Lock for Object</li>
        <li>Thread Does Work on Object</li>
        <li>Other Threads Cannot Acquire Lock While it is Held - They are Blocked</li>
        <li>Thread Releases Lock When Done</li>
        <li>Can Cause Deadlock if Not Done Properly</li>
    </ul>
</section>
            <footer class="footline">

            </footer>
          </article>

          </section>
          </section>
    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="java-threads">Java Threads</h1>

<p>Java includes several methods for creating threads. The simplest and most flexible is to implement the <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Runnable.html" target="_blank">Runnable</a>
 interface in a class, and then create a new <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Thread.html" target="_blank">Thread</a>
 that uses an instance of the class implementing <code>Runnable</code> as it&rsquo;s target.</p>
<p>It is also possible to create a class that inherits from the <code>Thread</code> class, which itself implements the <code>Runnable</code> interface. However, this is not recommended unless you need to perform more advanced work within the thread.</p>
<p>Here&rsquo;s a quick example of threads in Java:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">import</span> java.lang.Runnable<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.lang.Thread<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.lang.InterruptedException<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyThread</span> <span style="color:#66d9ef">implements</span> Runnable <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> String name<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * Constructor.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param name the name of the thread
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">MyThread</span><span style="color:#f92672">(</span>String name<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">name</span> <span style="color:#f92672">=</span> name<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * Thread method.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * &lt;p&gt;This is called when the thread is started.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> 3<span style="color:#f92672">;</span> i<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">name</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; : iteration &#34;</span> <span style="color:#f92672">+</span> i<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// tell the OS to wake this thread up after at least 1 second
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                Thread<span style="color:#f92672">.</span><span style="color:#a6e22e">sleep</span><span style="color:#f92672">(</span>1000<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>InterruptedException e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">name</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; was interrupted&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * Main Method.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// create threads
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        Thread thread1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Thread<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> MyThread<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Thread 1&#34;</span><span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>        Thread thread2 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Thread<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> MyThread<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Thread 2&#34;</span><span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>        Thread thread3 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Thread<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> MyThread<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Thread 3&#34;</span><span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// start threads
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;main: starting threads&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        thread1<span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        thread2<span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        thread3<span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// wait until all threads have terminated
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;main: joining threads&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            thread1<span style="color:#f92672">.</span><span style="color:#a6e22e">join</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            thread2<span style="color:#f92672">.</span><span style="color:#a6e22e">join</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            thread3<span style="color:#f92672">.</span><span style="color:#a6e22e">join</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>InterruptedException e<span style="color:#f92672">){</span>
</span></span><span style="display:flex;"><span>            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;main thread was interrupted&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;main: all threads terminated&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span></span></span></code></pre></div><p>Let&rsquo;s look at this code piece by piece so we fully understand how it works.</p>
<h4 id="imports">Imports</h4>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">import</span> java.lang.Runnable<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.lang.Thread<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.lang.InterruptedException<span style="color:#f92672">;</span></span></span></code></pre></div><p>We import both the <code>Runnable</code> interface and the <code>Thread</code> class, as well as the <code>InterruptedException</code> exception class. We have to wrap a few operations in a try-catch block to make sure that the thread isn&rsquo;t interrupted by the operating system unexpectedly.</p>
<h4 id="class-declaration">Class Declaration</h4>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyThread</span> <span style="color:#66d9ef">implements</span> Runnable <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> String name<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">MyThread</span><span style="color:#f92672">(</span>String name<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">name</span> <span style="color:#f92672">=</span> name<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#f92672">}</span></span></span></code></pre></div><p>The class is very simple. It implements the <code>Runnable</code> interface, which allows to wrap it in a <code>Thread</code> as we&rsquo;ll see later. Inside of the constructor, we are simply setting a <code>name</code> attribute so we can tell our threads apart.</p>
<h4 id="run-method">Run Method</h4>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> 3<span style="color:#f92672">;</span> i<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">name</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; : iteration &#34;</span> <span style="color:#f92672">+</span> i<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// tell the OS to wake this thread up after at least 1 second
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                Thread<span style="color:#f92672">.</span><span style="color:#a6e22e">sleep</span><span style="color:#f92672">(</span>1000<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>InterruptedException e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">name</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; was interrupted&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span></span></span></code></pre></div><p>The <code>run()</code> method is declared in the <code>Runnable</code> interface, so we must override it in our code. This method is pretty short - it simply iterates 3 times and prints the value of the iteration along with the thread&rsquo;s name, and then it uses the <code>Thread.sleep(1000)</code> method call. This tells the operating system to put this thread into a waiting state, and to not wake it up until at least 1000 milliseconds (1 second) has elapsed. Of course, we can&rsquo;t guarantee that the operating system won&rsquo;t make this thread wait even longer than that, but typically it will happen so fast that we won&rsquo;t be able to tell the difference.</p>
<p>However, many of the methods in the <code>Thread</code> class can throw an <code>InterruptedException</code> if the thread is interrupted while it is performing this operation. In practice, it happens rarely, but it is always recommended to wrap these operations in a try-catch statement.</p>
<h4 id="main-method">Main Method</h4>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// create threads
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        Thread thread1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Thread<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> MyThread<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Thread 1&#34;</span><span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>        Thread thread2 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Thread<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> MyThread<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Thread 2&#34;</span><span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>        Thread thread3 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Thread<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> MyThread<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Thread 3&#34;</span><span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// start threads
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;main: starting threads&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        thread1<span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        thread2<span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        thread3<span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// wait until all threads have terminated
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;main: joining threads&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            thread1<span style="color:#f92672">.</span><span style="color:#a6e22e">join</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            thread2<span style="color:#f92672">.</span><span style="color:#a6e22e">join</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            thread3<span style="color:#f92672">.</span><span style="color:#a6e22e">join</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>InterruptedException e<span style="color:#f92672">){</span>
</span></span><span style="display:flex;"><span>            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;main thread was interrupted&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;main: all threads terminated&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span></span></span></code></pre></div><p>Finally, the <code>main()</code> method will create three instances of the <code>Thread</code> class, and provide an instance of our <code>MyThread</code> class, which implements the <code>Runnable</code> interface, as arguments to the constructor. In effect, we are <em>wrapping</em> our runnable class in a thread.</p>
<p>Then, we call the <code>start()</code> method on the thread, which will actually create the thread through the operating system and start it running. Notice that we <strong>do not</strong> call the <code>run()</code> method directly - that is called for us once the thread is created in the <code>start()</code> method.</p>
<p>Finally, we call the <code>join()</code> method on each thread. The <code>join()</code> method will block this thread until the thread we called it on has terminated. So, by calling the <code>join()</code> method on each of the three threads, we are making sure that they have all finished their work before the main thread continues. Once again, this could throw an <code>InterruptedException</code>, so we&rsquo;ll use a try-catch statement to handle that.</p>
<p>That&rsquo;s all there is to this example!</p>
<h4 id="execution">Execution</h4>
<p>When we execute this example, we can see many different outputs, depending on how the threads are scheduled with the operating system. Below are a few that were observed when this program was executed during testing.</p>
<p>
<a href="#image-0cfe86e9cfdd66068832f0260711e94f" class="lightbox-link">
<img src="https://ksu-cs-textbooks.github.io/cc410/images/10/java_thread.png" alt="Java Threads" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-0cfe86e9cfdd66068832f0260711e94f">
<img src="https://ksu-cs-textbooks.github.io/cc410/images/10/java_thread.png" alt="Java Threads" class="lightbox-image" loading="lazy">
</a></p>
<p>If you look closely at these four lists, no two of them are exactly the same. This is because of how the operating system schedules threads - we cannot predict how it will work, and because of this a multithreaded program could run differently each time it is executed!</p>

            <footer class="footline">

            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="java-synchronization">Java Synchronization</h1>

<p>Next, let&rsquo;s look at a quick example of a race condition in Java, just so we can see how it could occur in our code.</p>
<h2 id="poorly-designed-multithreading">Poorly Designed Multithreading</h2>
<p>First, let&rsquo;s consider this example:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyData</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> x<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span></span></span></code></pre></div><div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">import</span> java.lang.Runnable<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.lang.Thread<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.lang.InterruptedException<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyThread</span> <span style="color:#66d9ef">implements</span> Runnable <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> String name<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> MyData data<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * Constructor.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param name the name of the thread
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">MyThread</span><span style="color:#f92672">(</span>String name<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">name</span> <span style="color:#f92672">=</span> name<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * Thread method.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * &lt;p&gt;This is called when the thread is started.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> 3<span style="color:#f92672">;</span> i<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">int</span> y <span style="color:#f92672">=</span> data<span style="color:#f92672">.</span><span style="color:#a6e22e">x</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// tell the OS it is ok to switch to another thread here
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            Thread<span style="color:#f92672">.</span><span style="color:#a6e22e">yield</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            data<span style="color:#f92672">.</span><span style="color:#a6e22e">x</span> <span style="color:#f92672">=</span> y <span style="color:#f92672">+</span> 1<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">name</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; : data.x = &#34;</span> <span style="color:#f92672">+</span> data<span style="color:#f92672">.</span><span style="color:#a6e22e">x</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * Main Method.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// create data
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        data <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> MyData<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// create threads
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        Thread thread1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Thread<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> MyThread<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Thread 1&#34;</span><span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>        Thread thread2 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Thread<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> MyThread<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Thread 2&#34;</span><span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>        Thread thread3 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Thread<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> MyThread<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Thread 3&#34;</span><span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// start threads
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;main: starting threads&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        thread1<span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        thread2<span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        thread3<span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// wait until all threads have terminated
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;main: joining threads&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            thread1<span style="color:#f92672">.</span><span style="color:#a6e22e">join</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            thread2<span style="color:#f92672">.</span><span style="color:#a6e22e">join</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            thread3<span style="color:#f92672">.</span><span style="color:#a6e22e">join</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>InterruptedException e<span style="color:#f92672">){</span>
</span></span><span style="display:flex;"><span>            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;main thread was interrupted&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;main: all threads terminated&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;main: data.x = &#34;</span> <span style="color:#f92672">+</span> data<span style="color:#f92672">.</span><span style="color:#a6e22e">x</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span></span></span></code></pre></div><h4 id="explanation">Explanation</h4>
<p>In this example, we are creating a <code>static</code> instance of the <code>MyData</code> class, which can act as a shared memory object for this example. Then, in each of the threads, we are performing this three-step process:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> y <span style="color:#f92672">=</span> data<span style="color:#f92672">.</span><span style="color:#a6e22e">x</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// tell the OS it is ok to switch to another thread here
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>Thread<span style="color:#f92672">.</span><span style="color:#a6e22e">yield</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>data<span style="color:#f92672">.</span><span style="color:#a6e22e">x</span> <span style="color:#f92672">=</span> y <span style="color:#f92672">+</span> 1<span style="color:#f92672">;</span></span></span></code></pre></div><p>Just as we saw in the earlier example, we are reading the current value stored in <code>data.x</code> into a variable <code>y</code>. Then, we are using the <code>Thread.yield()</code> method to tell the operating system that it is allowed to switch away from this thread at this point. In practice, we typically wouldn&rsquo;t use this method at all, but it is helpful for testing. In fact, <code>Thread.yield()</code> is effectively the same as calling <code>Thread.sleep(0)</code> - we are telling the operating system to put this thread to sleep, but then immediately add it back to the list of threads to be scheduled on the processor. Finally, we update the value stored in <code>data.x</code> to be one larger than the value we saved earlier.</p>
<p>In effect, this is essentially the Java code needed to reproduce the example we saw earlier in this class.</p>
<h4 id="execution">Execution</h4>
<p>So, what happens when we run this code? As it turns out, sometimes we&rsquo;ll see it get a different result than the one we expect:</p>
<p>
<a href="#image-78b0c7c071662e09232babaf5ca723aa" class="lightbox-link">
<img src="https://ksu-cs-textbooks.github.io/cc410/images/10/java_race.png" alt="Race Condition in Java" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-78b0c7c071662e09232babaf5ca723aa">
<img src="https://ksu-cs-textbooks.github.io/cc410/images/10/java_race.png" alt="Race Condition in Java" class="lightbox-image" loading="lazy">
</a></p>
<p>Uh oh! This is exactly what a race condition looks like in practice. In the screenshot on the right, we see that two threads set the same value into <code>data.x</code>, which means that they were running at the same time.</p>
<h2 id="java-synchronized-blocks">Java Synchronized Blocks</h2>
<p>To fix this, Java includes couple of special methods for dealing with synchronization. First, we can use the <code>synchronized</code> statement, which is simply a wrapper around a block of code that we&rsquo;d like to be <strong>atomic</strong>. An atomic block is one that shouldn&rsquo;t be broken apart and interrupted by other threads accessing the same object. In effect, the <code>synchronized</code> statement will handle acquiring and releasing a lock for us, based on the item used in the statement.</p>
<p>So, in this example, we can update the <code>run()</code> method to use a <code>synchronized</code> statement:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> 3<span style="color:#f92672">;</span> i<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">synchronized</span><span style="color:#f92672">(</span>data<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">int</span> y <span style="color:#f92672">=</span> data<span style="color:#f92672">.</span><span style="color:#a6e22e">x</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>                Thread<span style="color:#f92672">.</span><span style="color:#a6e22e">yield</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>                data<span style="color:#f92672">.</span><span style="color:#a6e22e">x</span> <span style="color:#f92672">=</span> y <span style="color:#f92672">+</span> 1<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>                System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">name</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; : data.x = &#34;</span> <span style="color:#f92672">+</span> data<span style="color:#f92672">.</span><span style="color:#a6e22e">x</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            Thread<span style="color:#f92672">.</span><span style="color:#a6e22e">yield</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span></span></span></code></pre></div><p>Here, the <code>synchronized</code> statement creates a <strong>lock</strong> that is associated with the <code>data</code> object in memory. Only one thread can hold that lock at a time, and by associating it with an object, we can easily keep track of which thread is able to access that object.</p>
<p>Now, when we execute that program, we&rsquo;ll always get the correct answer!</p>
<p>
<a href="#image-6d5ca72364c4e0c2dfea8f48d5da0175" class="lightbox-link">
<img src="https://ksu-cs-textbooks.github.io/cc410/images/10/java_synch.png" alt="Synchronized in Java" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-6d5ca72364c4e0c2dfea8f48d5da0175">
<img src="https://ksu-cs-textbooks.github.io/cc410/images/10/java_synch.png" alt="Synchronized in Java" class="lightbox-image" loading="lazy">
</a></p>

  
  
<div class="box notices cstyle info">
  <div class="box-label"><i class="fa-fw fas fa-info-circle"></i> Not Always Random?</div>
  <div class="box-content">

<p>In fact, to get the threads interleaved as shown in this screenshot, we had to add additional <code>Thread.sleep()</code> statements to the code! Otherwise, the program always seemed to schedule the threads in the same order on Codio. We cannot guarantee it will always happen like that, but it is an interesting quirk you can observe in multithreaded code. In practice, sometimes race conditions may only happen once in a million operations, making them extremely difficult to debug when they happen.</p>
</div>
</div>

            <footer class="footline">

            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="python-threads">Python Threads</h1>

<p>Python includes several methods for creating threads. The simplest and most flexible is to create a new <code>Thread</code> object using the <a href="https://docs.python.org/3/library/threading.html" target="_blank">threading</a>
 library. When that object is created, we can give it a function to use as a starting point for the thread.</p>
<p>Here&rsquo;s a quick example of threads in Python:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> threading
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> sys
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyThread</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self, name):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Constructor.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        Args:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            name: the name of the thread
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>__name <span style="color:#f92672">=</span> name
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">run</span>(self):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Thread method.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">3</span>):
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{}</span><span style="color:#e6db74"> : iteration </span><span style="color:#e6db74">{}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>format(self<span style="color:#f92672">.</span>__name, i))
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># tell the OS to wake this thread up after at least 1 second</span>
</span></span><span style="display:flex;"><span>            time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@staticmethod</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>(args):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># create threads</span>
</span></span><span style="display:flex;"><span>        t1_object <span style="color:#f92672">=</span> MyThread(<span style="color:#e6db74">&#34;Thread 1&#34;</span>)
</span></span><span style="display:flex;"><span>        thread1 <span style="color:#f92672">=</span> threading<span style="color:#f92672">.</span>Thread(target<span style="color:#f92672">=</span>t1_object<span style="color:#f92672">.</span>run)
</span></span><span style="display:flex;"><span>        t2_object <span style="color:#f92672">=</span> MyThread(<span style="color:#e6db74">&#34;Thread 2&#34;</span>)
</span></span><span style="display:flex;"><span>        thread2 <span style="color:#f92672">=</span> threading<span style="color:#f92672">.</span>Thread(target<span style="color:#f92672">=</span>t2_object<span style="color:#f92672">.</span>run)
</span></span><span style="display:flex;"><span>        t3_object <span style="color:#f92672">=</span> MyThread(<span style="color:#e6db74">&#34;Thread 3&#34;</span>)
</span></span><span style="display:flex;"><span>        thread3 <span style="color:#f92672">=</span> threading<span style="color:#f92672">.</span>Thread(target<span style="color:#f92672">=</span>t3_object<span style="color:#f92672">.</span>run)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># start threads</span>
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;main: starting threads&#34;</span>)
</span></span><span style="display:flex;"><span>        thread1<span style="color:#f92672">.</span>start()
</span></span><span style="display:flex;"><span>        thread2<span style="color:#f92672">.</span>start()
</span></span><span style="display:flex;"><span>        thread3<span style="color:#f92672">.</span>start()
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># wait until all threads have terminated</span>
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;main: joining threads&#34;</span>)
</span></span><span style="display:flex;"><span>        thread1<span style="color:#f92672">.</span>join()
</span></span><span style="display:flex;"><span>        thread2<span style="color:#f92672">.</span>join()
</span></span><span style="display:flex;"><span>        thread3<span style="color:#f92672">.</span>join()
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;main: all threads terminated&#34;</span>)
</span></span><span style="display:flex;"><span>                  
</span></span><span style="display:flex;"><span>                  
</span></span><span style="display:flex;"><span><span style="color:#75715e"># main guard</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    MyThread<span style="color:#f92672">.</span>main(sys<span style="color:#f92672">.</span>argv)</span></span></code></pre></div><p>Let&rsquo;s look at this code piece by piece so we fully understand how it works.</p>
<h4 id="imports">Imports</h4>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> threading
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> sys</span></span></code></pre></div><p>We import both the <code>threading</code> library, which allows us to create threads, as well as the <code>time</code> library to put threads to sleep. We&rsquo;ll also need the <code>sys</code> library to access command-line arguments, if any are used.</p>
<h4 id="class-declaration">Class Declaration</h4>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyThread</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self, name):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>__name <span style="color:#f92672">=</span> name</span></span></code></pre></div><p>The class is very simple. Inside of the constructor, we are simply setting a <code>name</code> attribute so we can tell our threads apart.</p>
<h4 id="run-method">Run Method</h4>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">run</span>(self):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">3</span>):
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{}</span><span style="color:#e6db74"> : iteration </span><span style="color:#e6db74">{}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>format(self<span style="color:#f92672">.</span>__name, i))
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># tell the OS to wake this thread up after at least 1 second</span>
</span></span><span style="display:flex;"><span>            time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">1</span>)</span></span></code></pre></div><p>The <code>run()</code> method is the method we&rsquo;ll use to start our threads. This method is pretty short - it simply iterates 3 times and prints the value of the iteration along with the thread&rsquo;s name, and then it uses the <code>time.sleep(1)</code> method call. This tells the operating system to put this thread into a waiting state, and to not wake it up until at least 1 second has elapsed. Of course, we can&rsquo;t guarantee that the operating system won&rsquo;t make this thread wait even longer than that, but typically it will happen so fast that we won&rsquo;t be able to tell the difference.</p>
<h4 id="main-method">Main Method</h4>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#a6e22e">@staticmethod</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>(args):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># create threads</span>
</span></span><span style="display:flex;"><span>        t1_object <span style="color:#f92672">=</span> MyThread(<span style="color:#e6db74">&#34;Thread 1&#34;</span>)
</span></span><span style="display:flex;"><span>        thread1 <span style="color:#f92672">=</span> threading<span style="color:#f92672">.</span>Thread(target<span style="color:#f92672">=</span>t1_object<span style="color:#f92672">.</span>run)
</span></span><span style="display:flex;"><span>        t2_object <span style="color:#f92672">=</span> MyThread(<span style="color:#e6db74">&#34;Thread 2&#34;</span>)
</span></span><span style="display:flex;"><span>        thread2 <span style="color:#f92672">=</span> threading<span style="color:#f92672">.</span>Thread(target<span style="color:#f92672">=</span>t2_object<span style="color:#f92672">.</span>run)
</span></span><span style="display:flex;"><span>        t3_object <span style="color:#f92672">=</span> MyThread(<span style="color:#e6db74">&#34;Thread 3&#34;</span>)
</span></span><span style="display:flex;"><span>        thread3 <span style="color:#f92672">=</span> threading<span style="color:#f92672">.</span>Thread(target<span style="color:#f92672">=</span>t3_object<span style="color:#f92672">.</span>run)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># start threads</span>
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;main: starting threads&#34;</span>)
</span></span><span style="display:flex;"><span>        thread1<span style="color:#f92672">.</span>start()
</span></span><span style="display:flex;"><span>        thread2<span style="color:#f92672">.</span>start()
</span></span><span style="display:flex;"><span>        thread3<span style="color:#f92672">.</span>start()
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># wait until all threads have terminated</span>
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;main: joining threads&#34;</span>)
</span></span><span style="display:flex;"><span>        thread1<span style="color:#f92672">.</span>join()
</span></span><span style="display:flex;"><span>        thread2<span style="color:#f92672">.</span>join()
</span></span><span style="display:flex;"><span>        thread3<span style="color:#f92672">.</span>join()
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;main: all threads terminated&#34;</span>)</span></span></code></pre></div><p>Finally, the <code>main()</code> method will create three instances of the <code>threading.Thread</code> class, and provide an instance of our <code>MyThread</code> class as the <code>target</code> argument to the constructor. In effect, we are <em>wrapping</em> our runnable class in a thread.</p>
<p>Then, we call the <code>start()</code> method on the thread, which will actually create the thread through the operating system and start it running. Notice that we <strong>do not</strong> call the <code>run()</code> method directly - that is called for us once the thread is created in the <code>start()</code> method.</p>
<p>Finally, we call the <code>join()</code> method on each thread. The <code>join()</code> method will block this thread until the thread we called it on has terminated. So, by calling the <code>join()</code> method on each of the three threads, we are making sure that they have all finished their work before the main thread continues.</p>
<p>That&rsquo;s all there is to this example!</p>
<h4 id="execution">Execution</h4>
<p>When we execute this example, we can see many different outputs, depending on how the threads are scheduled with the operating system. Below are a few that were observed when this program was executed during testing.</p>
<p>
<a href="#image-fb75f008b57619ee4d4d1348d949cb26" class="lightbox-link">
<img src="https://ksu-cs-textbooks.github.io/cc410/images/10/python_thread.png" alt="Python Threads" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-fb75f008b57619ee4d4d1348d949cb26">
<img src="https://ksu-cs-textbooks.github.io/cc410/images/10/python_thread.png" alt="Python Threads" class="lightbox-image" loading="lazy">
</a></p>
<p>If you look closely at these four lists, no two of them are exactly the same. This is because of how the operating system schedules threads - we cannot predict how it will work, and because of this a multithreaded program could run differently each time it is executed!</p>

            <footer class="footline">

            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="python-synchronization">Python Synchronization</h1>

<p>Next, let&rsquo;s look at a quick example of a race condition in Python, just so we can see how it could occur in our code.</p>
<h2 id="poorly-designed-multithreading">Poorly Designed Multithreading</h2>
<p>First, let&rsquo;s consider this example:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> threading
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> sys
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyData</span>:
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>x <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyThread</span>:
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    data <span style="color:#f92672">=</span> MyData()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self, name):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Constructor.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        Args:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            name: the name of the thread
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>__name <span style="color:#f92672">=</span> name
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">run</span>(self):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Thread method.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">3</span>):
</span></span><span style="display:flex;"><span>            y <span style="color:#f92672">=</span> MyThread<span style="color:#f92672">.</span>data<span style="color:#f92672">.</span>x
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># tell the OS it is ok to switch to another thread here</span>
</span></span><span style="display:flex;"><span>            time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>            MyThread<span style="color:#f92672">.</span>data<span style="color:#f92672">.</span>x <span style="color:#f92672">=</span> y <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{}</span><span style="color:#e6db74"> : data.x = </span><span style="color:#e6db74">{}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>format(self<span style="color:#f92672">.</span>__name, MyThread<span style="color:#f92672">.</span>data<span style="color:#f92672">.</span>x))
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@staticmethod</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>(args):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># create threads</span>
</span></span><span style="display:flex;"><span>        t1_object <span style="color:#f92672">=</span> MyThread(<span style="color:#e6db74">&#34;Thread 1&#34;</span>)
</span></span><span style="display:flex;"><span>        thread1 <span style="color:#f92672">=</span> threading<span style="color:#f92672">.</span>Thread(target<span style="color:#f92672">=</span>t1_object<span style="color:#f92672">.</span>run)
</span></span><span style="display:flex;"><span>        t2_object <span style="color:#f92672">=</span> MyThread(<span style="color:#e6db74">&#34;Thread 2&#34;</span>)
</span></span><span style="display:flex;"><span>        thread2 <span style="color:#f92672">=</span> threading<span style="color:#f92672">.</span>Thread(target<span style="color:#f92672">=</span>t2_object<span style="color:#f92672">.</span>run)
</span></span><span style="display:flex;"><span>        t3_object <span style="color:#f92672">=</span> MyThread(<span style="color:#e6db74">&#34;Thread 3&#34;</span>)
</span></span><span style="display:flex;"><span>        thread3 <span style="color:#f92672">=</span> threading<span style="color:#f92672">.</span>Thread(target<span style="color:#f92672">=</span>t3_object<span style="color:#f92672">.</span>run)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># start threads</span>
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;main: starting threads&#34;</span>)
</span></span><span style="display:flex;"><span>        thread1<span style="color:#f92672">.</span>start()
</span></span><span style="display:flex;"><span>        thread2<span style="color:#f92672">.</span>start()
</span></span><span style="display:flex;"><span>        thread3<span style="color:#f92672">.</span>start()
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># wait until all threads have terminated</span>
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;main: joining threads&#34;</span>)
</span></span><span style="display:flex;"><span>        thread1<span style="color:#f92672">.</span>join()
</span></span><span style="display:flex;"><span>        thread2<span style="color:#f92672">.</span>join()
</span></span><span style="display:flex;"><span>        thread3<span style="color:#f92672">.</span>join()
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;main: all threads terminated&#34;</span>)
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;main: data.x = </span><span style="color:#e6db74">{}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>format(MyThread<span style="color:#f92672">.</span>data<span style="color:#f92672">.</span>x))
</span></span><span style="display:flex;"><span>                  
</span></span><span style="display:flex;"><span>                  
</span></span><span style="display:flex;"><span><span style="color:#75715e"># main guard</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    MyThread<span style="color:#f92672">.</span>main(sys<span style="color:#f92672">.</span>argv)</span></span></code></pre></div><h4 id="explanation">Explanation</h4>
<p>In this example, we are creating a static instance of the <code>MyData</code> class, attached directly to the <code>MyThread</code> class and not a particular object, which can act as a shared memory object for this example. Then, in each of the threads, we are performing this three-step process:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>y <span style="color:#f92672">=</span> MyThread<span style="color:#f92672">.</span>data<span style="color:#f92672">.</span>x
</span></span><span style="display:flex;"><span><span style="color:#75715e"># tell the OS it is ok to switch to another thread here</span>
</span></span><span style="display:flex;"><span>time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>MyThread<span style="color:#f92672">.</span>data<span style="color:#f92672">.</span>x <span style="color:#f92672">=</span> y <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span></span></span></code></pre></div><p>Just as we saw in the earlier example, we are reading the current value stored in <code>data.x</code> into a variable <code>y</code>. Then, we are using the <code>time.sleep(0)</code> method to tell the operating system to put this thread to sleep, but then immediately add it back to the list of threads to be scheduled on the processor. Finally, we update the value stored in <code>data.x</code> to be one larger than the value we saved earlier.</p>
<p>In effect, this is essentially the Python code needed to reproduce the example we saw earlier in this class.</p>
<h4 id="execution">Execution</h4>
<p>So, what happens when we run this code? As it turns out, sometimes we&rsquo;ll see it get a different result than the one we expect:</p>
<p>
<a href="#image-b8cad33bfa426e64c2fc8403aea9df91" class="lightbox-link">
<img src="https://ksu-cs-textbooks.github.io/cc410/images/10/python_race.png" alt="Race Condition in Python" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-b8cad33bfa426e64c2fc8403aea9df91">
<img src="https://ksu-cs-textbooks.github.io/cc410/images/10/python_race.png" alt="Race Condition in Python" class="lightbox-image" loading="lazy">
</a></p>
<p>Uh oh! This is exactly what a race condition looks like in practice. In the screenshot on the right, we see that two threads set the same value into <code>data.x</code>, which means that they were running at the same time.</p>
<h2 id="python-lock">Python Lock</h2>
<p>To fix this, Python includes a <strong>lock</strong> that we can use as part of a <code>with</code> statement, which is simply a wrapper around a block of code that we&rsquo;d like to be <strong>atomic</strong>. An atomic block is one that shouldn&rsquo;t be broken apart and interrupted by other threads accessing the same object. In effect, using a <code>with</code> statement along with a lock will handle acquiring and releasing the lock for us.</p>
<p>So, in this example, we can update the <code>MyThread</code> class to have a lock:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyThread</span>:
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    data <span style="color:#f92672">=</span> MyData()
</span></span><span style="display:flex;"><span>    lock <span style="color:#f92672">=</span> threading<span style="color:#f92672">.</span>Lock()</span></span></code></pre></div><p>When, we can update the <code>run()</code> method to use a <code>with</code> statement:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">run</span>(self):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">3</span>):
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">with</span> MyThread<span style="color:#f92672">.</span>lock:
</span></span><span style="display:flex;"><span>                y <span style="color:#f92672">=</span> MyThread<span style="color:#f92672">.</span>data<span style="color:#f92672">.</span>x
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># tell the OS it is ok to switch to another thread here</span>
</span></span><span style="display:flex;"><span>                time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>                MyThread<span style="color:#f92672">.</span>data<span style="color:#f92672">.</span>x <span style="color:#f92672">=</span> y <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>                print(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{}</span><span style="color:#e6db74"> : data.x = </span><span style="color:#e6db74">{}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>format(self<span style="color:#f92672">.</span>__name, MyThread<span style="color:#f92672">.</span>data<span style="color:#f92672">.</span>x))
</span></span><span style="display:flex;"><span>            time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">0</span>)</span></span></code></pre></div><p>Here, the <code>with</code> statement acquires the <strong>lock</strong> that is associated with the <code>data</code> object in the <code>MyThread</code> class. Only one thread can hold that lock at a time, and by associating it with an object, we can easily keep track of which thread is able to access that object.</p>
<p>Now, when we execute that program, we&rsquo;ll always get the correct answer!</p>
<p>
<a href="#image-b9f0955bba1011c44bf4d927cf5f3a5b" class="lightbox-link">
<img src="https://ksu-cs-textbooks.github.io/cc410/images/10/python_synch.png" alt="Synchronized in Python" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-b9f0955bba1011c44bf4d927cf5f3a5b">
<img src="https://ksu-cs-textbooks.github.io/cc410/images/10/python_synch.png" alt="Synchronized in Python" class="lightbox-image" loading="lazy">
</a></p>

  
  
<div class="box notices cstyle info">
  <div class="box-label"><i class="fa-fw fas fa-info-circle"></i> Not Always Random?</div>
  <div class="box-content">

<p>In fact, to get the threads interleaved as shown in this screenshot, we had to add additional <code>time.sleep(0)</code> statements to the code! Otherwise, the program always seemed to schedule the threads in the same order on Codio. We cannot guarantee it will always happen like that, but it is an interesting quirk you can observe in multithreaded code. In practice, sometimes race conditions may only happen once in a million operations, making them extremely difficult to debug when they happen.</p>
</div>
</div>

            <footer class="footline">

            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="summary">Summary</h1>

<p>In this chapter, we learned about <strong>processes</strong> and <strong>threads</strong>. A process is an instance of an application running on our computer, and it can be broken up into multiple <strong>threads</strong> of execution.</p>
<p>Creating threads is very simple - in most cases, we just need to define a function that is used as the starting point for the thread. However, in multithreaded programs, dealing with shared memory can be tricky, and if done incorrectly we can run into <strong>race conditions</strong> which cause our programs to possibly lose data.</p>
<p>To combat this, programming languages and our operating system provide methods for <strong>thread synchronization</strong>, namely <strong>locks</strong> that prevent multiple threads from running at the same time.</p>
<p>Then, we saw some quick examples for how to create threads in both Java and Python, and how to handle basic race conditions through the use of locks in each language.</p>
<p>In the next chapter, we&rsquo;ll introduce <strong>event-driven programming</strong>, which depends on multiple threads to make our GUI responsive to the user even while our application is doing work in the background.</p>
<h2 id="review-quiz">Review Quiz</h2>
<p>Check your understanding of the new content introduced in this chapter below - this quiz is not graded and you can retake it as many times as you want.</p>






<i>Quizdown quiz omitted from print view.</i>

            <footer class="footline">

            </footer>
          </article>

          </section>

        </div>
      </main>
    
<div class="git-footer">
<p class="theme-version-footer">5.18.0</p>
<p>Last modified by: 
            <i class='fas fa-user'></i> Russell Feldhausen
            <i class='fas fa-calendar'></i> <a href="https://gitlab.cs.ksu.edu/cc/410/generic/textbook/-/commit/2512e31ed7413085fb2b6a90abb854c5d1e43258">Aug 10, 2023</a>
</p>
</div>

    
    </div>
    <script src="https://ksu-cs-textbooks.github.io/cc410/js/clipboard.min.js?1691701675" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/cc410/js/perfect-scrollbar.min.js?1691701675" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/cc410/js/theme.js?1691701675" defer></script>
  </body>
</html>
