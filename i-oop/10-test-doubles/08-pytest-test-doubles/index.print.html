




	
	
		

	
	
		

	
	
		

	
	
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		
		

	
	
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		
		

	
	
		
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		
		
		
		

	
	
		

	
	
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		
<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.101.0">
    <meta name="generator" content="Relearn 5.18.0">
    <meta name="description" content="CC 410 Textbook">
    <meta name="author" content="Russell Feldhausen">
    <title>Test Doubles in pytest :: CC 410 Textbook</title>
    <link href="https://ksu-cs-textbooks.github.io/cc410/i-oop/10-test-doubles/08-pytest-test-doubles/index.html" rel="canonical" type="text/html" title="Test Doubles in pytest :: CC 410 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cc410/i-oop/10-test-doubles/08-pytest-test-doubles/index.xml" rel="alternate" type="application/rss+xml" title="Test Doubles in pytest :: CC 410 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cc410/i-oop/10-test-doubles/08-pytest-test-doubles/tele.html" rel="alternate" type="text/html" title="Test Doubles in pytest :: CC 410 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cc410/i-oop/10-test-doubles/08-pytest-test-doubles/embed.html" rel="alternate" type="text/html" title="Test Doubles in pytest :: CC 410 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cc410/images/favicon.ico?1691701595" rel="icon" type="image/x-icon" sizes="any">
    <!-- https://github.com/filamentgroup/loadCSS/blob/master/README.md#how-to-use -->
    <link href="https://ksu-cs-textbooks.github.io/cc410/css/fontawesome-all.min.css?1691701674" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cc410/css/fontawesome-all.min.css?1691701674" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cc410/css/nucleus.css?1691701674" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cc410/css/auto-complete.css?1691701674" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cc410/css/auto-complete.css?1691701674" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cc410/css/perfect-scrollbar.min.css?1691701674" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cc410/css/fonts.css?1691701674" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cc410/css/fonts.css?1691701674" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cc410/css/theme.css?1691701674" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cc410/css/theme-auto.css?1691701674" rel="stylesheet" id="variant-style">
    <link href="https://ksu-cs-textbooks.github.io/cc410/css/variant.css?1691701674" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cc410/css/print.css?1691701674" rel="stylesheet" media="print">
    <link href="https://ksu-cs-textbooks.github.io/cc410/css/format-print.css?1691701674" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cc410/css/ie.css?1691701674" rel="stylesheet">
    <script src="https://ksu-cs-textbooks.github.io/cc410/js/url.js?1691701674"></script>
    <script src="https://ksu-cs-textbooks.github.io/cc410/js/variant.js?1691701674"></script>
    <script>
      // hack to let hugo tell us how to get to the root when using relativeURLs, it needs to be called *url= for it to do its magic:
      // https://github.com/gohugoio/hugo/blob/145b3fcce35fbac25c7033c91c1b7ae6d1179da8/transform/urlreplacers/absurlreplacer.go#L72
      window.index_js_url="https://ksu-cs-textbooks.github.io/cc410/index.search.js";
      var root_url="https://ksu-cs-textbooks.github.io/cc410/";
      var baseUri=root_url.replace(/\/$/, '');
      // translations
      window.T_Copy_to_clipboard = 'Copy to clipboard';
      window.T_Copied_to_clipboard = 'Copied to clipboard!';
      window.T_Copy_link_to_clipboard = 'Copy link to clipboard';
      window.T_Link_copied_to_clipboard = 'Copied link to clipboard!';
      window.T_No_results_found = 'No results found for \u0022{0}\u0022';
      window.T_N_results_found = '{1} results found for \u0022{0}\u0022';
      // some further base stuff
      var baseUriFull='https:\/\/ksu-cs-textbooks.github.io\/cc410/';
      window.variants && variants.init( [ 'auto', 'light-theme', 'dark-theme' ] );
    </script>
    
    <link href="https://ksu-cs-textbooks.github.io/cc410/css/custom.css?1691701674" rel="stylesheet">

  </head>
  <body class="mobile-support print disableInlineCopyToClipboard" data-url="https://ksu-cs-textbooks.github.io/cc410/i-oop/10-test-doubles/08-pytest-test-doubles/index.html">
    <div id="body" class="default-animation">
      <div id="sidebar-overlay"></div>
      <div id="toc-overlay"></div>
      <nav id="topbar" class="highlightable">
        <div>
          <div id="top-tele-link">
            <a class="print-link" title='Teleprompter View' href="https://ksu-cs-textbooks.github.io/cc410/i-oop/10-test-doubles/08-pytest-test-doubles/tele.html">
              <i class="fas fa-tv fa-fw"></i>
            </a>
          </div>
          <div id="top-embed-link">
            <a class="print-link" title='Embeddable Version' href="https://ksu-cs-textbooks.github.io/cc410/i-oop/10-test-doubles/08-pytest-test-doubles/embed.html">
              <i class="fas fa-expand-arrows-alt fa-fw"></i>
            </a>
          </div>
          <div id="breadcrumbs">
            <span id="sidebar-toggle-span">
              <a href="#" id="sidebar-toggle" class="topbar-link" title='Menu (CTRL+ALT+n)'><i class="fas fa-bars fa-fw"></i></a>
            </span>
            <ol class="links" itemscope itemtype="http://schema.org/BreadcrumbList">
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="https://ksu-cs-textbooks.github.io/cc410/index.html"><span itemprop="name">CC 410 - Advanced Programming</span></a><meta itemprop="position" content="1"> &gt; </li>
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="https://ksu-cs-textbooks.github.io/cc410/i-oop/index.html"><span itemprop="name">OOP</span></a><meta itemprop="position" content="2"> &gt; </li>
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="https://ksu-cs-textbooks.github.io/cc410/i-oop/10-test-doubles/index.html"><span itemprop="name">Test Doubles</span></a><meta itemprop="position" content="3"> &gt; </li>
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">Test Doubles in pytest</span><meta itemprop="position" content="4"></li>
            </ol>
          </div>
        </div>
      </nav>
      <main id="body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="default">
            <header class="headline">
            </header>
<h1 id="test-doubles-in-pytest">Test Doubles in pytest</h1>

<p><a href="https://www.youtube.com/watch?v=pNqcrx785Gs">YouTube Video</a></p>
<p><a href="https://ksu-cs-textbooks.github.io/cc410/i-oop/10-test-doubles/08-pytest-test-doubles/video/">Video Materials</a>
</p>
<p>To create test doubles in Python, we&rsquo;ll rely on the built-in <a href="https://docs.python.org/3/library/unittest.mock.html" target="_blank">unittest.mock</a>
 library. It includes lots of quick and easy methods for creating fake objects in Python, and it is compatible with the pytest testing framework that we&rsquo;re already using.</p>
<h2 id="adding-mocks-to-a-test-class">Adding Mocks to a Test Class</h2>
<p>There are many different ways to use the <code>unittest.mock</code> library. One of the easiest ways is to import the <code>patch</code> annotation</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> unittest.mock <span style="color:#f92672">import</span> patch
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TestClassroom</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># tests here</span>
</span></span><span style="display:flex;"><span>    </span></span></code></pre></div><h2 id="creating-fake-objects">Creating Fake Objects</h2>
<p>Once we&rsquo;ve imported the <code>patch</code> annotation, we can use it to create fake objects for our test methods.</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> unittest.mock <span style="color:#f92672">import</span> patch
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> people.Person <span style="color:#f92672">import</span> Person
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> people.Teacher <span style="color:#f92672">import</span> Teacher
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> places.Classroom <span style="color:#f92672">import</span> Classroom
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TestClassroom</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@patch</span>(<span style="color:#e6db74">&#39;people.Teacher&#39;</span>, spec<span style="color:#f92672">=</span>Teacher)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@patch</span>(<span style="color:#e6db74">&#39;people.Person&#39;</span>, spec<span style="color:#f92672">=</span>Person)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_classroom_has_teacher</span>(self, fake_person, fake_teacher) <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># test code</span>
</span></span><span style="display:flex;"><span>    </span></span></code></pre></div><p>This will create fake objects <code>fake_person</code> and <code>fake_teacher</code> that mimic the attributes and methods contained in the <code>Person</code> and <code>Teacher</code> classes, respectively. However, by default, those objects won&rsquo;t do anything, and most methods will not actually work by default.</p>
<p>Notice that the fake objects are added as parameters to our test method, but they are added in reverse order. This is because method annotations are interpreted &ldquo;inside-out&rdquo;, so the one at the bottom, closest to the method, is interpreted first. So, in this example, our <code>fake_person</code> will be created first, followed by our <code>fake_teacher</code>.</p>
<p>Without doing anything else, we can use these fake objects in place of the real ones, as in this test:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> unittest.mock <span style="color:#f92672">import</span> patch
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> people.Person <span style="color:#f92672">import</span> Person
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> people.Teacher <span style="color:#f92672">import</span> Teacher
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> places.Classroom <span style="color:#f92672">import</span> Classroom
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TestClassroom</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@patch</span>(<span style="color:#e6db74">&#39;people.Teacher&#39;</span>, spec<span style="color:#f92672">=</span>Teacher)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@patch</span>(<span style="color:#e6db74">&#39;people.Person&#39;</span>, spec<span style="color:#f92672">=</span>Person)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_classroom_has_teacher</span>(self, fake_person, fake_teacher) <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>        classroom: Classroom <span style="color:#f92672">=</span> Classroom()
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">assert</span> classroom<span style="color:#f92672">.</span>has_teacher <span style="color:#f92672">==</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        classroom<span style="color:#f92672">.</span>add_teacher(fake_teacher)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">assert</span> classroom<span style="color:#f92672">.</span>has_teacher <span style="color:#f92672">==</span> <span style="color:#66d9ef">True</span> </span></span></code></pre></div><p>As we can see, we are able to add the <code>fake_teacher</code> object to our classroom, and it is treated just like any other <code>Teacher</code> object, at least as far as the system is concerned thus far.</p>
<p>However, if we want those fake objects to do something, we have to include method stubs as well.</p>
<h2 id="adding-stubs">Adding Stubs</h2>
<p>To add a method stub to a fake object, we can set the <code>return_value</code> of the method:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> unittest.mock <span style="color:#f92672">import</span> patch
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> people.Person <span style="color:#f92672">import</span> Person
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> people.Teacher <span style="color:#f92672">import</span> Teacher
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> places.Classroom <span style="color:#f92672">import</span> Classroom
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TestClassroom</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@patch</span>(<span style="color:#e6db74">&#39;people.Teacher&#39;</span>, spec<span style="color:#f92672">=</span>Teacher)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@patch</span>(<span style="color:#e6db74">&#39;people.Person&#39;</span>, spec<span style="color:#f92672">=</span>Person)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_classroom_get_teacher_name</span>(self, fake_person, fake_teacher) <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># create a method stub for `get_name` method</span>
</span></span><span style="display:flex;"><span>        fake_teacher<span style="color:#f92672">.</span>get_name<span style="color:#f92672">.</span>return_value <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Teacher Person&#34;</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        classroom: Classroom <span style="color:#f92672">=</span> Classroom()
</span></span><span style="display:flex;"><span>        classroom<span style="color:#f92672">.</span>add_teacher(fake_teacher)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># assert that the classroom returns the teacher&#39;s name</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">assert</span> classroom<span style="color:#f92672">.</span>get_teacher_name() <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;Teacher Person&#34;</span></span></span></code></pre></div><p>In this example, we are adding a method stub to our <code>fake_teacher</code> object that will return <code>&quot;Teacher Person&quot;</code> whenever the <code>get_name()</code> method is called. Then, we are adding that fake <code>Teacher</code> object to the <code>Classroom</code> class that we are testing, and calling the <code>get_teacher_name()</code> method. We&rsquo;re assuming that the <code>get_teacher_name()</code> method in the <code>Classroom</code> class calls the <code>get_name()</code> method of the <code>Teacher</code> object contained in the class. However, instead of using a real <code>Teacher</code> instance, we&rsquo;ve provided a fake object that only knows what to do when that one method is called. So, it returns the value we expect, which passes our test!</p>
<h2 id="stubbing-properties">Stubbing Properties</h2>
<p>If our classes use properties instead of traditional getter and setter methods, we have to create our property stubs in a slightly different way:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> unittest.mock <span style="color:#f92672">import</span> patch, PropertyMock
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> people.Person <span style="color:#f92672">import</span> Person
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> people.Teacher <span style="color:#f92672">import</span> Teacher
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> places.Classroom <span style="color:#f92672">import</span> Classroom
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TestClassroom</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@patch</span>(<span style="color:#e6db74">&#39;people.Teacher&#39;</span>, spec<span style="color:#f92672">=</span>Teacher)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@patch</span>(<span style="color:#e6db74">&#39;people.Person&#39;</span>, spec<span style="color:#f92672">=</span>Person)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_classroom_get_teacher_name</span>(self, fake_person, fake_teacher) <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># create a property stub for `get_name` property</span>
</span></span><span style="display:flex;"><span>        type(fake_teacher)<span style="color:#f92672">.</span>name <span style="color:#f92672">=</span> PropertyMock(return_value<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Teacher Person&#34;</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        classroom: Classroom <span style="color:#f92672">=</span> Classroom()
</span></span><span style="display:flex;"><span>        classroom<span style="color:#f92672">.</span>add_teacher(fake_teacher)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># assert that the classroom returns the teacher&#39;s name</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">assert</span> classroom<span style="color:#f92672">.</span>get_teacher_name() <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;Teacher Person&#34;</span></span></span></code></pre></div><p>In this case, we are creating an instance of the <a href="https://docs.python.org/3/library/unittest.mock.html#unittest.mock.PropertyMock" target="_blank">PropertyMock</a>
 class that acts as a fake property for an object. However, because of how fake objects work, we cannot directly attach the <code>PropertyMock</code> instance directly to the <code>fake_teacher</code> object. Instead, we must attach it to the mock type object, which we can access by using the <code>type</code> method. Thankfully, even if we have several fake instances of the same class, these properties will be unique to the fake instance, not to the class they are faking.</p>
<h2 id="faking-static-classes">Faking Static Classes</h2>
<p>There is one more complex use case we may run into in our testing - creating a fake version of a class with static methods.</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> unittest.mock <span style="color:#f92672">import</span> patch, PropertyMock
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> people.Person <span style="color:#f92672">import</span> Person
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> people.Teacher <span style="color:#f92672">import</span> Teacher
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> places.Classroom <span style="color:#f92672">import</span> Classroom
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> rules.TeacherRules <span style="color:#f92672">import</span> TeacherRules
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> pytest
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TestClassroom</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@patch</span>(<span style="color:#e6db74">&#39;people.Teacher&#39;</span>, spec<span style="color:#f92672">=</span>Teacher)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@patch</span>(<span style="color:#e6db74">&#39;people.Person&#39;</span>, spec<span style="color:#f92672">=</span>Person)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_teacher_fails_minimum_age_requirement</span>(self, fake_person, fake_teacher) <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># create a fake version of the static method</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">with</span> patch<span style="color:#f92672">.</span>object(TeacherRules, <span style="color:#e6db74">&#39;get_minimum_age&#39;</span>, return_value<span style="color:#f92672">=</span><span style="color:#ae81ff">16</span>):
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Add a fake property to the teacher</span>
</span></span><span style="display:flex;"><span>            type(fake_teacher)<span style="color:#f92672">.</span>age <span style="color:#f92672">=</span> PropertyMock(return_value<span style="color:#f92672">=</span><span style="color:#ae81ff">15</span>)
</span></span><span style="display:flex;"><span>            classroom: Classroom <span style="color:#f92672">=</span> Classroom()
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">with</span> pytest<span style="color:#f92672">.</span>raises(<span style="color:#a6e22e">ValueError</span>):
</span></span><span style="display:flex;"><span>                classroom<span style="color:#f92672">.</span>add_teacher(fake_teacher)</span></span></code></pre></div><p>In this example, we have a <code>TeacherRules</code> class that includes a static method <code>get_minimum_age()</code> that returns the minimum age allowed for a teacher. To test this, we are creating a fake version of that static method using the <code>patch.object</code> method. We have to do this in a with statement, which makes sure that the fake method does not persist outside of this test. In this case, we&rsquo;ll set that method to return a value of <code>16</code>.</p>
<p>We&rsquo;ll also add a method stub to return an invalid age on our fake <code>Teacher</code> object. Finally, when we try to add that teacher to a classroom, it should raise an exception since the teacher is not old enough.</p>
<p>This is a very brief introduction to using test doubles made with the unittest.mock library, but it should be enough for our use in this class. Feel free to refer to some of the documentation linked below for more examples and information.</p>
<h3 id="references">References</h3>
<ul>
<li><a href="https://docs.python.org/3/library/unittest.mock.html" target="_blank">unittest.mock</a>
 Documentatio</li>
<li><a href="https://realpython.com/python-mock-library/" target="_blank">Understanding the Python Mock Object Library</a>
 from Real Python</li>
</ul>

            <footer class="footline">

            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Test Doubles in pytest</h1>
    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="python-test-doubles">Python Test Doubles</h1>


<a href="https://www.youtube.com/watch?v=pNqcrx785Gs">YouTube Video</a>

<h4 id="resources">Resources</h4>
<ul>
<li><a href="https://ksu-cs-textbooks.github.io/cc410/i-oop/10-test-doubles/08-pytest-test-doubles/video/slides/" target="_blank">Slides</a></li>
</ul>
<h4 id="video-script">Video Script</h4>
<p>To use test doubles in Python, we&rsquo;re going to rely on the built-in <code>unittest.mock</code> library. This is by far the easiest way to work with fake objects and method stubs in Python, and we don&rsquo;t have to install anything else to use it. So, all we have to do is import a few parts of that library into our code. In most cases, we&rsquo;re going to use the <code>patch</code> annotation, so that&rsquo;s what we&rsquo;ll import initially.</p>
<p>To create a fake object using patch, we&rsquo;ll add the <code>@patch</code> annotation above the unit test method that will use the fake object. In the <code>@patch</code> annotation, we include the full path of the object we are creating as a string, as well as a <code>spec</code> attribute that points to the name of the class we would like it to mimic. So, in this example, we are creating fake versions of the <code>people.Teacher</code> and <code>people.Person</code> classes, using those class names as the spec we&rsquo;d like to follow. Then, inside of our method definition, we include those objects as parameters. Notice that the <code>@patch</code> annotations are applied inside out. So, the first one for <code>Teacher</code> is the last method parameter, and they work inward from there. This also means that any parameterized unit tests will have the <code>@pytest.mark</code> annotations above the <code>@patch</code> annotations. Finally, inside of our unit test method, we can use those objects just like we would real instances of that class. They&rsquo;ll satisfy any type checking we do, and will work just fine as lon as we don&rsquo;t call any methods on that object.</p>
<p>However, if we want to call those methods, we&rsquo;ll have to include method stubs in our code. In Python, there are several ways to do this, but the easiest is to just replace the method&rsquo;s <code>return_value</code> attribute with our desired output. Any fake object in Python will already include default implementations of any method, but they will just return nothing. So, we can just update that value to return <code>&quot;Teacher Person&quot;</code>, and then in our unit test we can verify that we receive the correct output.</p>
<p>Creating a stub for a property is similar. Instead of changing a method&rsquo;s return value, we attach a <code>PropertyMock</code> to the type of the fake object. Each fake object created by Python will be given its own type, which we can modify to achieve certain outcomes. So, we simply update the <code>name</code> attribute of the type of our <code>fake_teacher</code> object to a <code>PropertyMock</code> that returns our desired value. Now, in our code, anything that accesses the <code>name</code> property will receive that value. Pretty handy!</p>
<p>Finally, what if we want to create a fake version of a static class? This is a bit more difficult, but thankfully it can be done. Here, we are using the <code>patch.object</code> method to create a method stub for a static method in the <code>TeacherRules</code> class. The only catch is that we must do this in a <code>with</code> statement, which makes sure that the fake static method doesn&rsquo;t stick around after the unit test. When those static methods are called anywhere within that <code>with</code> statement, it will use our stubbed versions, allowing us to control what the rest of the application sees.</p>
<p>As we can see, using <code>unittest.mock</code> to create fake objects and method stubs in Python is quite simple. However, this is just scratching the surface of what that library can really do. So, feel free to refer to the documentation for additional information and ideas of ways you can use <code>unittest.mock</code> in your unit tests.</p>

            <footer class="footline">

            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Python Test Doubles</h1>
    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id=""></h1>

<section>
    <h3>Add Mocks to Test Class</h3>
    <pre><code class="python">from unittest.mock import patch<br><br>
class TestClassroom:<br>
    # tests here</code></pre>
</section>
<section>
    <h3>Creating Fake Objects</h3>
    <pre><code class="python stretch" style="font-size: 30px">from unittest.mock import patch
from people.Person import Person
from people.Teacher import Teacher
from places.Classroom import Classroom<br><br>
class TestClassroom:<br>
    @patch('people.Teacher', spec=Teacher)
    @patch('people.Person', spec=Person)
    def test_classroom_has_teacher(self, fake_person, fake_teacher) -> None:
        classroom: Classroom = Classroom()
        assert classroom.has_teacher == False<br>
        classroom.add_teacher(fake_teacher)
        assert classroom.has_teacher == True 
    </code></pre>
</section>
<section>
    <h3>Adding a Method Stub</h3>
    <pre><code class="python stretch" style="font-size: 29px">@patch('people.Teacher', spec=Teacher)
@patch('people.Person', spec=Person)
def test_classroom_get_teacher_name(self, fake_person, fake_teacher) -> None:
    # create a method stub for `get_name` method
    fake_teacher.get_name.return_value = "Teacher Person"<br>
    classroom: Classroom = Classroom()
    classroom.add_teacher(fake_teacher)<br>
    # assert that the classroom returns the teacher's name
    assert classroom.get_teacher_name() == "Teacher Person"
    </code></pre>
</section>
<section>
    <h3>Adding a Property Stub</h3>
    <pre><code class="python stretch" style="font-size: 29px">@patch('people.Teacher', spec=Teacher)
@patch('people.Person', spec=Person)
def test_classroom_get_teacher_name(self, fake_person, fake_teacher) -> None:
    # create a property stub for `get_name` property
    type(fake_teacher).name = PropertyMock(return_value="Teacher Person")<br>
    classroom: Classroom = Classroom()
    classroom.add_teacher(fake_teacher)<br>
    # assert that the classroom returns the teacher's name
    assert classroom.get_teacher_name() == "Teacher Person"
    </code></pre>
</section>
<section>
    <h3>Static Classes</h3>
    <pre><code class="python stretch" style="font-size: 26px">@patch('people.Teacher', spec=Teacher)
@patch('people.Person', spec=Person)
def test_teacher_fails_minimum_age_requirement(self, fake_person, fake_teacher) -> None:
    # create a fake version of the static method
    with patch.object(TeacherRules, 'get_minimum_age', return_value=16):<br>
        # Add a fake property to the teacher
        type(fake_teacher).age = PropertyMock(return_value=15)
        classroom: Classroom = Classroom()<br>
        with pytest.raises(ValueError):
            classroom.add_teacher(fake_teacher)
        </code></pre>
</section>

            <footer class="footline">

            </footer>
          </article>

          </section>
          </section>

        </div>
      </main>
    
<div class="git-footer">
<p class="theme-version-footer">5.18.0</p>
<p>Last modified by: 
            <i class='fas fa-user'></i> Russell Feldhausen
            <i class='fas fa-calendar'></i> <a href="https://gitlab.cs.ksu.edu/cc/410/generic/textbook/-/commit/ab8e74b4d3ef564767d2a29ddf402148da6f966a">Jan 19, 2023</a>
</p>
</div>

    
    </div>
    <script src="https://ksu-cs-textbooks.github.io/cc410/js/clipboard.min.js?1691701675" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/cc410/js/perfect-scrollbar.min.js?1691701675" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/cc410/js/theme.js?1691701675" defer></script>
  </body>
</html>
