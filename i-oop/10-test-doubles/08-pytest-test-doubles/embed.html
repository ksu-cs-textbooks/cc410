




	
	
		

	
	
		

	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		
		

	
	
		

	
	
		
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		
		
		
		

	
	
		

	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.101.0">
    <meta name="generator" content="Relearn 5.2.0+tip">
    <meta name="description" content="CC 410 Textbook">
    <meta name="author" content="Russell Feldhausen">
    <title>Test Doubles in pytest :: CC 410 Textbook</title>
    <link href="https://ksu-cs-textbooks.github.io/cc410/i-oop/10-test-doubles/08-pytest-test-doubles/" rel="canonical" type="text/html" title="CC 410 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cc410/i-oop/10-test-doubles/08-pytest-test-doubles/index.xml" rel="alternate" type="application/rss+xml" title="CC 410 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cc410/i-oop/10-test-doubles/08-pytest-test-doubles/index.print.html" rel="alternate" type="text/html" title="CC 410 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cc410/i-oop/10-test-doubles/08-pytest-test-doubles/tele.html" rel="alternate" type="text/html" title="CC 410 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cc410/images/favicon.ico?1680789649" rel="icon" type="image/x-icon">
    <!-- https://github.com/filamentgroup/loadCSS/blob/master/README.md#how-to-use -->
    <link href="https://ksu-cs-textbooks.github.io/cc410/css/fontawesome-all.min.css?1680789649" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cc410/css/fontawesome-all.min.css?1680789649" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cc410/css/featherlight.min.css?1680789649" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cc410/css/featherlight.min.css?1680789649" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cc410/css/auto-complete.css?1680789649" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cc410/css/auto-complete.css?1680789649" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cc410/css/perfect-scrollbar.min.css?1680789649" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cc410/css/nucleus.css?1680789649" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cc410/css/fonts.css?1680789649" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cc410/css/fonts.css?1680789649" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cc410/css/theme.css?1680789649" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cc410/css/theme-light-theme.css?1680789649" rel="stylesheet" id="variant-style">
    <link href="https://ksu-cs-textbooks.github.io/cc410/css/ie.css?1680789649" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cc410/css/variant.css?1680789649" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cc410/css/print.css?1680789649" rel="stylesheet" media="print">
    <script src="https://ksu-cs-textbooks.github.io/cc410/js/variant.js?1680789649"></script>
    <script>
      // hack to let hugo tell us how to get to the root when using relativeURLs, it needs to be called *url= for it to do its magic:
      // https://github.com/gohugoio/hugo/blob/145b3fcce35fbac25c7033c91c1b7ae6d1179da8/transform/urlreplacers/absurlreplacer.go#L72
      var index_url="https://ksu-cs-textbooks.github.io/cc410/index.json";
      var root_url="https://ksu-cs-textbooks.github.io/cc410/";
      var baseUri=root_url.replace(/\/$/, '');
      // translations
      window.T_Copy_to_clipboard = 'Copy to clipboard';
      window.T_Copied_to_clipboard = 'Copied to clipboard!';
      window.T_Copy_link_to_clipboard = 'Copy link to clipboard';
      window.T_Link_copied_to_clipboard = 'Copied link to clipboard!';
      // some further base stuff
      var baseUriFull='https:\/\/ksu-cs-textbooks.github.io\/cc410/';
      window.variants && variants.init( [ 'light-theme', 'dark-theme' ] );
    </script>
    
    <link href="https://ksu-cs-textbooks.github.io/cc410/css/custom.css?1680789649" rel="stylesheet">
    <script src="https://ksu-cs-textbooks.github.io/cc410/js/jquery.min.js?1680789649" defer></script>

  </head>
  <body class="mobile-support embed disableInlineCopyToClipboard" data-url="https://ksu-cs-textbooks.github.io/cc410/i-oop/10-test-doubles/08-pytest-test-doubles/embed.html">
    <div id="body" class="default-animation">
      
      
      
      <main id="body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <div id="head-tags">
          </div>
          <article class="default">
    
    
    
<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube.com/embed/pNqcrx785Gs" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>
<p>

<a href="https://ksu-cs-textbooks.github.io/cc410/i-oop/10-test-doubles/08-pytest-test-doubles/video/embed.html">Video Materials</a></p>
<p>To create test doubles in Python, we&rsquo;ll rely on the built-in 

<a href="https://docs.python.org/3/library/unittest.mock.html" target="_blank" rel="noopener">unittest.mock</a> library. It includes lots of quick and easy methods for creating fake objects in Python, and it is compatible with the pytest testing framework that we&rsquo;re already using.</p>
<h2 id="adding-mocks-to-a-test-class">Adding Mocks to a Test Class</h2>
<p>There are many different ways to use the <code>unittest.mock</code> library. One of the easiest ways is to import the <code>patch</code> annotation</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> unittest.mock <span style="color:#f92672">import</span> patch
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TestClassroom</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># tests here</span>
</span></span><span style="display:flex;"><span>    
</span></span></code></pre></div><h2 id="creating-fake-objects">Creating Fake Objects</h2>
<p>Once we&rsquo;ve imported the <code>patch</code> annotation, we can use it to create fake objects for our test methods.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> unittest.mock <span style="color:#f92672">import</span> patch
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> people.Person <span style="color:#f92672">import</span> Person
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> people.Teacher <span style="color:#f92672">import</span> Teacher
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> places.Classroom <span style="color:#f92672">import</span> Classroom
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TestClassroom</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@patch</span>(<span style="color:#e6db74">&#39;people.Teacher&#39;</span>, spec<span style="color:#f92672">=</span>Teacher)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@patch</span>(<span style="color:#e6db74">&#39;people.Person&#39;</span>, spec<span style="color:#f92672">=</span>Person)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_classroom_has_teacher</span>(self, fake_person, fake_teacher) <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># test code</span>
</span></span><span style="display:flex;"><span>    
</span></span></code></pre></div><p>This will create fake objects <code>fake_person</code> and <code>fake_teacher</code> that mimic the attributes and methods contained in the <code>Person</code> and <code>Teacher</code> classes, respectively. However, by default, those objects won&rsquo;t do anything, and most methods will not actually work by default.</p>
<p>Notice that the fake objects are added as parameters to our test method, but they are added in reverse order. This is because method annotations are interpreted &ldquo;inside-out&rdquo;, so the one at the bottom, closest to the method, is interpreted first. So, in this example, our <code>fake_person</code> will be created first, followed by our <code>fake_teacher</code>.</p>
<p>Without doing anything else, we can use these fake objects in place of the real ones, as in this test:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> unittest.mock <span style="color:#f92672">import</span> patch
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> people.Person <span style="color:#f92672">import</span> Person
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> people.Teacher <span style="color:#f92672">import</span> Teacher
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> places.Classroom <span style="color:#f92672">import</span> Classroom
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TestClassroom</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@patch</span>(<span style="color:#e6db74">&#39;people.Teacher&#39;</span>, spec<span style="color:#f92672">=</span>Teacher)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@patch</span>(<span style="color:#e6db74">&#39;people.Person&#39;</span>, spec<span style="color:#f92672">=</span>Person)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_classroom_has_teacher</span>(self, fake_person, fake_teacher) <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>        classroom: Classroom <span style="color:#f92672">=</span> Classroom()
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">assert</span> classroom<span style="color:#f92672">.</span>has_teacher <span style="color:#f92672">==</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        classroom<span style="color:#f92672">.</span>add_teacher(fake_teacher)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">assert</span> classroom<span style="color:#f92672">.</span>has_teacher <span style="color:#f92672">==</span> <span style="color:#66d9ef">True</span> 
</span></span></code></pre></div><p>As we can see, we are able to add the <code>fake_teacher</code> object to our classroom, and it is treated just like any other <code>Teacher</code> object, at least as far as the system is concerned thus far.</p>
<p>However, if we want those fake objects to do something, we have to include method stubs as well.</p>
<h2 id="adding-stubs">Adding Stubs</h2>
<p>To add a method stub to a fake object, we can set the <code>return_value</code> of the method:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> unittest.mock <span style="color:#f92672">import</span> patch
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> people.Person <span style="color:#f92672">import</span> Person
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> people.Teacher <span style="color:#f92672">import</span> Teacher
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> places.Classroom <span style="color:#f92672">import</span> Classroom
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TestClassroom</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@patch</span>(<span style="color:#e6db74">&#39;people.Teacher&#39;</span>, spec<span style="color:#f92672">=</span>Teacher)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@patch</span>(<span style="color:#e6db74">&#39;people.Person&#39;</span>, spec<span style="color:#f92672">=</span>Person)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_classroom_get_teacher_name</span>(self, fake_person, fake_teacher) <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># create a method stub for `get_name` method</span>
</span></span><span style="display:flex;"><span>        fake_teacher<span style="color:#f92672">.</span>get_name<span style="color:#f92672">.</span>return_value <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Teacher Person&#34;</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        classroom: Classroom <span style="color:#f92672">=</span> Classroom()
</span></span><span style="display:flex;"><span>        classroom<span style="color:#f92672">.</span>add_teacher(fake_teacher)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># assert that the classroom returns the teacher&#39;s name</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">assert</span> classroom<span style="color:#f92672">.</span>get_teacher_name() <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;Teacher Person&#34;</span>
</span></span></code></pre></div><p>In this example, we are adding a method stub to our <code>fake_teacher</code> object that will return <code>&quot;Teacher Person&quot;</code> whenever the <code>get_name()</code> method is called. Then, we are adding that fake <code>Teacher</code> object to the <code>Classroom</code> class that we are testing, and calling the <code>get_teacher_name()</code> method. We&rsquo;re assuming that the <code>get_teacher_name()</code> method in the <code>Classroom</code> class calls the <code>get_name()</code> method of the <code>Teacher</code> object contained in the class. However, instead of using a real <code>Teacher</code> instance, we&rsquo;ve provided a fake object that only knows what to do when that one method is called. So, it returns the value we expect, which passes our test!</p>
<h2 id="stubbing-properties">Stubbing Properties</h2>
<p>If our classes use properties instead of traditional getter and setter methods, we have to create our property stubs in a slightly different way:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> unittest.mock <span style="color:#f92672">import</span> patch, PropertyMock
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> people.Person <span style="color:#f92672">import</span> Person
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> people.Teacher <span style="color:#f92672">import</span> Teacher
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> places.Classroom <span style="color:#f92672">import</span> Classroom
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TestClassroom</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@patch</span>(<span style="color:#e6db74">&#39;people.Teacher&#39;</span>, spec<span style="color:#f92672">=</span>Teacher)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@patch</span>(<span style="color:#e6db74">&#39;people.Person&#39;</span>, spec<span style="color:#f92672">=</span>Person)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_classroom_get_teacher_name</span>(self, fake_person, fake_teacher) <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># create a property stub for `get_name` property</span>
</span></span><span style="display:flex;"><span>        type(fake_teacher)<span style="color:#f92672">.</span>name <span style="color:#f92672">=</span> PropertyMock(return_value<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Teacher Person&#34;</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        classroom: Classroom <span style="color:#f92672">=</span> Classroom()
</span></span><span style="display:flex;"><span>        classroom<span style="color:#f92672">.</span>add_teacher(fake_teacher)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># assert that the classroom returns the teacher&#39;s name</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">assert</span> classroom<span style="color:#f92672">.</span>get_teacher_name() <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;Teacher Person&#34;</span>
</span></span></code></pre></div><p>In this case, we are creating an instance of the 

<a href="https://docs.python.org/3/library/unittest.mock.html#unittest.mock.PropertyMock" target="_blank" rel="noopener">PropertyMock</a> class that acts as a fake property for an object. However, because of how fake objects work, we cannot directly attach the <code>PropertyMock</code> instance directly to the <code>fake_teacher</code> object. Instead, we must attach it to the mock type object, which we can access by using the <code>type</code> method. Thankfully, even if we have several fake instances of the same class, these properties will be unique to the fake instance, not to the class they are faking.</p>
<h2 id="faking-static-classes">Faking Static Classes</h2>
<p>There is one more complex use case we may run into in our testing - creating a fake version of a class with static methods.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> unittest.mock <span style="color:#f92672">import</span> patch, PropertyMock
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> people.Person <span style="color:#f92672">import</span> Person
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> people.Teacher <span style="color:#f92672">import</span> Teacher
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> places.Classroom <span style="color:#f92672">import</span> Classroom
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> rules.TeacherRules <span style="color:#f92672">import</span> TeacherRules
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> pytest
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TestClassroom</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@patch</span>(<span style="color:#e6db74">&#39;people.Teacher&#39;</span>, spec<span style="color:#f92672">=</span>Teacher)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@patch</span>(<span style="color:#e6db74">&#39;people.Person&#39;</span>, spec<span style="color:#f92672">=</span>Person)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_teacher_fails_minimum_age_requirement</span>(self, fake_person, fake_teacher) <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># create a fake version of the static method</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">with</span> patch<span style="color:#f92672">.</span>object(TeacherRules, <span style="color:#e6db74">&#39;get_minimum_age&#39;</span>, return_value<span style="color:#f92672">=</span><span style="color:#ae81ff">16</span>):
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Add a fake property to the teacher</span>
</span></span><span style="display:flex;"><span>            type(fake_teacher)<span style="color:#f92672">.</span>age <span style="color:#f92672">=</span> PropertyMock(return_value<span style="color:#f92672">=</span><span style="color:#ae81ff">15</span>)
</span></span><span style="display:flex;"><span>            classroom: Classroom <span style="color:#f92672">=</span> Classroom()
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">with</span> pytest<span style="color:#f92672">.</span>raises(<span style="color:#a6e22e">ValueError</span>):
</span></span><span style="display:flex;"><span>                classroom<span style="color:#f92672">.</span>add_teacher(fake_teacher)
</span></span></code></pre></div><p>In this example, we have a <code>TeacherRules</code> class that includes a static method <code>get_minimum_age()</code> that returns the minimum age allowed for a teacher. To test this, we are creating a fake version of that static method using the <code>patch.object</code> method. We have to do this in a with statement, which makes sure that the fake method does not persist outside of this test. In this case, we&rsquo;ll set that method to return a value of <code>16</code>.</p>
<p>We&rsquo;ll also add a method stub to return an invalid age on our fake <code>Teacher</code> object. Finally, when we try to add that teacher to a classroom, it should raise an exception since the teacher is not old enough.</p>
<p>This is a very brief introduction to using test doubles made with the unittest.mock library, but it should be enough for our use in this class. Feel free to refer to some of the documentation linked below for more examples and information.</p>
<h3 id="references">References</h3>
<ul>
<li>

<a href="https://docs.python.org/3/library/unittest.mock.html" target="_blank" rel="noopener">unittest.mock</a> Documentatio</li>
<li>

<a href="https://realpython.com/python-mock-library/" target="_blank" rel="noopener">Understanding the Python Mock Object Library</a> from Real Python</li>
</ul>

            <footer class="footline">
            </footer>
          </article>
        </div>
      </main>
    </div>
    
    
    
    <script src="https://ksu-cs-textbooks.github.io/cc410/js/clipboard.min.js?1680789649" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/cc410/js/perfect-scrollbar.min.js?1680789649" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/cc410/js/featherlight.min.js?1680789649" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/cc410/js/theme.js?1680789649" defer></script>
    
    <script src="https://ksu-cs-textbooks.github.io/cc410/js/embed-iframe.js?1680789649 defer"></script>
    
  </body>
</html>
